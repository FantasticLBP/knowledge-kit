#  electron-PCç«¯å¤šç«¯èåˆæ–¹æ¡ˆ

> æ¯å¤©éƒ½è¦å†™ç¬¬äºŒå¤©çš„ todoListã€‚æœ‰ä¸€å¤©åœ¨å†™çš„æ—¶å€™çªç„¶æƒ³åˆ°ï¼Œä¸ºäº†è®©è‡ªå·±æ¸…æ¥šçŸ¥é“è‡ªå·±éœ€è¦åšå•¥ã€åšäº†å¤šå°‘ã€è¿˜å‰©å¤šå°‘æ²¡åšï¼Œæƒ³å†™ä¸€ä¸ªç”µè„‘ç«¯ç¨‹åºï¼Œåœ¨æŠ€æœ¯é€‰å‹çš„æ—¶å€™å°±é€‰äº† electronã€‚




## ä¸€ã€ æ–¹æ¡ˆé€‰å‹

3å¤©æ—¶é—´å†™äº†ä¸ª PC ç«¯åº”ç”¨ç¨‹åºã€‚å…ˆçœ‹çœ‹ç»“æœå§

![Todo1](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-04-TodoApp1.png)

![Todo1](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-04-TodoApp2.png)

![Todo1](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-04-TodoApp3.png)

ä¸ºä»€ä¹ˆè¦é€‰ electron ä½œä¸º pc ç«¯å¼€å‘æ–¹æ¡ˆï¼Ÿ
å²å‰æ—¶ä»£ï¼Œä»¥ MFC ä¸ºä»£è¡¨çš„æŠ€æœ¯æ ˆï¼Œå¼€å‘æ•ˆç‡è¾ƒä½ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚
åæ¥ä½¿ç”¨ QT æŠ€æœ¯ï¼Œç‰¹ç‚¹æ˜¯ä½¿ç”¨ DirectUI + é¢å‘å¯¹è±¡ + XML å®šä¹‰ UIï¼Œé€‚ç”¨äºå°å‹è½¯ä»¶ã€æ€§èƒ½è¦æ±‚ã€åŒ…å¤§å°ã€UI å¤æ‚åº¦å«é«˜çš„éœ€æ±‚ã€‚
å†åˆ°åæ¥ï¼Œä»¥ QT Quick ä¸ºä»£è¡¨çš„æŠ€æœ¯ï¼Œç‰¹ç‚¹æ˜¯æ¡†æ¶æœ¬èº«æä¾›å­æ§ä»¶ï¼ŒåŸºäºå­æ§ä»¶ç»„åˆæ¥åˆ›å»ºæ–°çš„æ§ä»¶ã€‚ç±»ä¼¼äº ActionScript çš„è„šæœ¬åŒ–ç•Œé¢é€»è¾‘ä»£ç ã€‚
æ–°æ—¶ä»£ä¸»è¦æ˜¯ä»¥ [electron](https://electronjs.org) å’Œ [Cef](https://bitbucket.org/chromiumembedded/cef) ä¸º ä»£è¡¨ã€‚ç‰¹ç‚¹æ˜¯ç•Œé¢å¼€å‘ä»¥ Web æŠ€æœ¯ä¸ºä¸»ï¼Œéƒ¨åˆ†é€»è¾‘éœ€è¦ Native ä»£ç å®ç°ã€‚å¤§å®¶éƒ½ç†Ÿæ‚‰çš„ VS Code å°±æ˜¯ä½¿ç”¨ electron å¼€å‘çš„ã€‚é€‚ç”¨äº UI å˜åŒ–è¾ƒå¤šã€ä½“ç§¯é™åˆ¶ä¸å¤§ã€å¼€å‘æ•ˆç‡é«˜çš„åœºæ™¯ã€‚

æ‹¿ C ç³»åˆ—å†™åº”ç”¨ç¨‹åºçš„ä½“éªŒä¸å¥½ï¼Œç´¯åˆ°å¥”æºƒã€‚å†åŠ ä¸Šæœ‰ Hybridã€React Nativeã€iOSã€Vueã€React ç­‰å¼€å‘ç»éªŒï¼Œelectron æ˜¯ä¸äºŒé€‰æ‹©ã€‚




## äºŒã€ Quick start
æ‰§è¡Œä¸‹é¢å‘½ä»¤å¿«é€Ÿä½“éªŒ Hello worldï¼Œä¹Ÿæ˜¯å®˜æ–¹ç»™çš„ä¸€ä¸ª Demoã€‚
```shell
git clone https://github.com/electron/electron-quick-start
cd electron-quick-start
npm install && npm start
```

ç®€å•ä»‹ç»ä¸‹ Demo å·¥ç¨‹ï¼Œå·¥ç¨‹ç›®å½•å¦‚ä¸‹æ‰€ç¤º
![](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-04-21-electron-packagejson.png)

åœ¨ç»ˆç«¯æ‰§è¡Œ `npm start` æ‰§è¡Œçš„æ˜¯ package.json ä¸­çš„ `scripts` èŠ‚ç‚¹ä¸‹çš„ start å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ `electron .`ï¼Œ`.` ä»£è¡¨æ‰§è¡Œ main.js ä¸­çš„é€»è¾‘ã€‚

```Javascript
// Modules to control application life and create native browser window
const {app, BrowserWindow} = require('electron')
const path = require('path')

function createWindow () {
  // Create the browser window.
  const mainWindow = new BrowserWindow({
    width: 800,
    height: 600,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js')
    }
  })

  // and load the index.html of the app.
  mainWindow.loadFile('index.html')

  // Open the DevTools.
  mainWindow.webContents.openDevTools()
}

// This method will be called when Electron has finished
// initialization and is ready to create browser windows.
// Some APIs can only be used after this event occurs.
app.whenReady().then(createWindow)

// Quit when all windows are closed.
app.on('window-all-closed', function () {
  // On macOS it is common for applications and their menu bar
  // to stay active until the user quits explicitly with Cmd + Q
  if (process.platform !== 'darwin') app.quit()
})

app.on('activate', function () {
  // On macOS it's common to re-create a window in the app when the
  // dock icon is clicked and there are no other windows open.
  if (BrowserWindow.getAllWindows().length === 0) createWindow()
})

// In this file you can include the rest of your app's specific main process
// code. You can also put them in separate files and require them here.
```
å†™è¿‡ Vueã€Reactã€Native çš„äººçœ‹ä»£ç å¾ˆå®¹æ˜“ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°æ˜¯å¾ˆé‡è¦çš„ï¼Œå¼€å‘è€…æ ¹æ®éœ€æ±‚åœ¨é’©å­å‡½æ•°é‡Œé¢åšç›¸åº”çš„è§†å›¾åˆ›å»ºã€åˆå§‹åŒ–ã€é”€æ¯å¯¹è±¡ç­‰ç­‰ã€‚æ¯”å¦‚ electron ä¸­çš„ activateã€window-all-closed ç­‰ã€‚

app å¯¹è±¡åœ¨ `whenReady` çš„æ—¶å€™æ‰§è¡Œ createWindow æ–¹æ³•ã€‚å†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ª  `BrowserWindow` å¯¹è±¡ï¼ŒæŒ‡å®šäº†å¤§å°å’ŒåŠŸèƒ½è®¾ç½®ï¼ˆwebPreferences Object (å¯é€‰) - ç½‘é¡µåŠŸèƒ½çš„è®¾ç½®ã€‚å…¶ä¸­ preload String (å¯é€‰) - åœ¨é¡µé¢è¿è¡Œå…¶ä»–è„šæœ¬ä¹‹å‰é¢„å…ˆåŠ è½½æŒ‡å®šçš„è„šæœ¬ æ— è®ºé¡µé¢æ˜¯å¦é›†æˆ Node, æ­¤è„šæœ¬éƒ½å¯ä»¥è®¿é—®æ‰€æœ‰ Node API è„šæœ¬è·¯å¾„ä¸ºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚ å½“ node integration å…³é—­æ—¶, é¢„åŠ è½½çš„è„šæœ¬å°†ä»å…¨å±€èŒƒå›´é‡æ–°å¼•å…¥ node çš„å…¨å±€å¼•ç”¨æ ‡å¿—ï¼‰ã€‚

`mainWindow.loadFile('index.html')` åŠ è½½äº†åŒçº§ç›®å½•ä¸‹çš„ index.html æ–‡ä»¶ã€‚ä¹Ÿå¯ä»¥åŠ è½½æœåŠ¡å™¨èµ„æºï¼ˆéƒ¨ç½²å¥½çš„ç½‘é¡µï¼‰ï¼Œæ¯”å¦‚ `win.loadURL('https://github.com/FantasticLBP')`

```javascript
// All of the Node.js APIs are available in the preload process.
// It has the same sandbox as a Chrome extension.
window.addEventListener('DOMContentLoaded', () => {
  const replaceText = (selector, text) => {
    const element = document.getElementById(selector)
    if (element) element.innerText = text
  }
  console.table(process)
  console.info(process.versions)
  for (const type of ['chrome', 'node', 'electron']) {
    replaceText(`${type}-version`, process.versions[type])
  }
})
```

æ¥ä¸‹å»çœ‹çœ‹ preload.jsã€‚åœ¨é¡µé¢è¿è¡Œå…¶ä»–è„šæœ¬ä¹‹å‰é¢„å…ˆåŠ è½½æŒ‡å®šçš„è„šæœ¬ï¼Œæ— è®ºé¡µé¢æ˜¯å¦é›†æˆ Node, æ­¤è„šæœ¬éƒ½å¯ä»¥è®¿é—®æ‰€æœ‰ Node API è„šæœ¬è·¯å¾„ä¸ºæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚Demo ä¸­çš„é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯è¯»å– process.versions å¯¹è±¡ä¸­çš„ nodeã€chromeã€electron çš„ç‰ˆæœ¬ä¿¡æ¯å¹¶å±•ç¤ºå‡ºæ¥ã€‚


index.html ä¸­çš„å†…å®¹å°±æ˜¯ä¸»é¡µé¢æ˜¾ç¤ºçš„å†…å®¹ã€‚




## ä¸‰ã€ å®ç°åŸç†

electron åˆ†ä¸ºæ¸²æŸ“è¿›ç¨‹å’Œä¸»è¿›ç¨‹ã€‚ ğŸ˜‚ å’Œ Native ä¸­çš„æ¦‚å¿µä¸ä¸€æ ·çš„æ˜¯ electron ä¸­ä¸»è¿›ç¨‹åªæœ‰ä¸€ä¸ªï¼Œæ¸²æŸ“è¿›ç¨‹ï¼ˆä¹Ÿå°±æ˜¯ UI è¿›ç¨‹ï¼‰ æœ‰å¤šä¸ªã€‚ä¸»è¿›ç¨‹åœ¨åå°è¿è¡Œï¼Œæ¯æ¬¡æ‰“å¼€ä¸€ä¸ªç•Œé¢ï¼Œä¼šæ–°å¼€ä¸€ä¸ªæ–°çš„æ¸²æŸ“è¿›ç¨‹ã€‚

- æ¸²æŸ“è¿›ç¨‹ï¼š ç”¨æˆ·çœ‹åˆ°çš„ web ç•Œé¢å°±æ˜¯ç”±æ¸²æŸ“è¿›ç¨‹ç»˜åˆ¶å‡ºæ¥çš„ï¼ŒåŒ…æ‹¬ htmlã€cssã€jsã€‚
- ä¸»è¿›ç¨‹ï¼šelectron è¿è¡Œ package.json ä¸­çš„ main.js è„šæœ¬çš„è¿›ç¨‹è¢«ç§°ä¸ºä¸»è¿›ç¨‹ã€‚åœ¨ä¸»è¿›ç¨‹ä¸­è¿è¡Œçš„è„šæœ¬é€šè¿‡åˆ›å»º web é¡µé¢æ¥å±•ç¤ºç”¨æˆ·ç•Œé¢ã€‚ä¸€ä¸ª electron åº”ç”¨ç¨‹åºæ€»æ˜¯åªæœ‰ä¸€ä¸ªä¸»è¿›ç¨‹ã€‚

 

### 1. Chromium æ¶æ„



![Chromium æ¶æ„](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-03-ChromiumArch.png)

è¿™å¼ å›¾æ˜¯ chromium å¤šè¿›ç¨‹æ¶æ„å›¾ã€‚æ—©åœ¨2007å¹´ä¹‹å‰ï¼Œå¸‚é¢ä¸Šçš„æµè§ˆå™¨éƒ½æ˜¯å•è¿›ç¨‹æ¶æ„ã€‚å•è¿›ç¨‹æµè§ˆå™¨æŒ‡çš„æ˜¯æµè§ˆå™¨çš„æ‰€æœ‰åŠŸèƒ½æ¨¡å—éƒ½æ˜¯è¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œçš„ï¼Œè¿™äº›æ¨¡å—åŒ…æ‹¬ç½‘ç»œã€æ’ä»¶ã€Javascript è¿è¡Œç¯å¢ƒã€æ¸²æŸ“å¼•æ“å’Œé¡µé¢ç­‰ã€‚å¦‚æ­¤å¤æ‚çš„åŠŸèƒ½éƒ½åœ¨ä¸€ä¸ªè¿›ç¨‹å†…è¿è¡Œï¼Œæ‰€ä»¥å¯¼è‡´æµè§ˆå™¨å‡ºç°ä¸ç¨³å®šã€ä¸å®‰å…¨ã€ä¸æµç•…ç­‰é—®é¢˜ã€‚

å¤šè¿›ç¨‹æ¶æ„çš„æµè§ˆå™¨è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œè‡³äºå¦‚ä½•è§£å†³çš„ä»¥åçš„æ–‡ç« ä¼šä¸“é—¨è®²è§£ï¼Œä¸æ˜¯æœ¬æ–‡çš„ä¸»è¦å†…å®¹ã€‚

ç®€å•æè¿°ä¸‹ã€‚

- ä¸»è¿›ç¨‹ä¸­çš„ `RenderProcessHost` å’Œ render è¿›ç¨‹ä¸­çš„ `RenderProcess` æ˜¯ç”¨æ¥å¤„ç†è¿›ç¨‹é—´é€šä¿¡çš„ï¼ˆIPCï¼‰ã€‚
- Render è¿›ç¨‹ä¸­çš„ RenderView å†…å®¹åŸºäº WebKit æ’ç‰ˆå±•ç¤ºå‡ºæ¥çš„
- Render è¿›ç¨‹ä¸­çš„ `ResourceDispatcher` æ˜¯ç”¨æ¥å¤„ç†èµ„æºè¯·æ±‚çš„ã€‚Render è¿›ç¨‹ä¸­å¦‚æœæœ‰è¯·æ±‚åˆ™åˆ›å»ºä¸€ä¸ªè¯·æ±‚ IDï¼Œè½¬å‘åˆ° IPCï¼Œç”± Browser è¿›ç¨‹ä¸­å¤„ç†åè¿”å›
- Chromium æ˜¯å¤šè¿›ç¨‹æ¶æ„ï¼ŒåŒ…æ‹¬ä¸€ä¸ªä¸»è¿›ç¨‹ï¼Œå¤šä¸ªæ¸²æŸ“è¿›ç¨‹

å¯¹äº chromium å¤šè¿›ç¨‹æ¶æ„æ„Ÿå…´è¶£çš„å¯ä»¥ç‚¹å‡»è¿™ä¸ªé“¾æ¥æŸ¥çœ‹æ›´å¤šèµ„æ–™-[Multi-process Architecture](http://www.chromium.org/developers/design-documents/multi-process-architecture)ã€‚



### 2. Electron æ¶æ„

![](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-03-ElectronArch.png)



Electron æ¶æ„å’Œ Chromium æ¶æ„ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…·æœ‰1ä¸ªä¸»è¿›ç¨‹å’Œå¤šä¸ªæ¸²æŸ“è¿›ç¨‹ã€‚ä½†æ˜¯ä¹Ÿæœ‰åŒºåˆ«

- åœ¨å„ä¸ªè¿›è¡Œä¸­æš´éœ²äº† Native API ï¼Œæä¾›äº† Native èƒ½åŠ›ã€‚
- å¼•å…¥äº† Node.jsï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ Node çš„èƒ½åŠ›



**æŠ€æœ¯éš¾ç‚¹**ï¼šç”±äº Electron å†…éƒ¨æ•´åˆäº† Chromium å’Œ Node.jsï¼Œä¸»çº¿ç¨‹åœ¨æŸä¸ªæ—¶åˆ»åªå¯ä»¥æ‰§è¡Œä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œä½†æ˜¯2è€…çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ä¸ä¸€æ ·ï¼ŒNode.js çš„äº‹ä»¶å¾ªç¯åŸºäº [libuv](https://github.com/libuv/libuv)ï¼Œä½†æ˜¯ Chromium åŸºäº [message bump](https://chromium.googlesource.com/chromium/chromium/+/master/base/message_pump.h)ã€‚

æ‰€ä»¥ Electron åŸç†çš„é‡ç‚¹å°±æ˜¯ã€Œå¦‚ä½•æ•´åˆäº‹ä»¶å¾ªç¯ã€ã€‚2ç§æ€è·¯

- Chromium é›†æˆåˆ° Node.js ä¸­ï¼šç”¨ libuv å®ç° messagebumpï¼ˆNode-Webkit å°±æ˜¯è¿™ä¹ˆå¹²çš„ï¼Œç¼ºç‚¹æŒºå¤šï¼‰
- Node.js é›†æˆåˆ° Chromium ä¸­ï¼ˆElectron æ‰€é‡‡ç”¨çš„æ–¹å¼ï¼‰

åæ¥éšç€ libuv å¼•å…¥ backend_fd çš„æ¦‚å¿µï¼Œç›¸å½“äºæ˜¯ libuv è½®è¯¢äº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€‚é€šè¿‡è½®è®­ backend_fd å¯ä»¥çŸ¥é“ libuv çš„æ–°äº‹ä»¶ã€‚æ‰€ä»¥ Electron é‡‡å–çš„åšæ³•å°±æ˜¯å°† Node.js é›†æˆåˆ° Chromium ä¸­ã€‚



![Node.jsä¸Chromiumé€šä¿¡](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-03-ChromiumCommunicateWithNode.png)

ä¸Šå›¾æè¿°äº† Node.js å¦‚ä½•èå…¥åˆ° Chromium  ä¸­ã€‚æè¿°ä¸‹åŸç†

- Electron æ–°èµ·ä¸€ä¸ªå®‰å…¨çº¿ç¨‹å»è½®è®­ backend_fd
- å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–°çš„ backend_fdï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ–°çš„ Node.js äº‹ä»¶ä¹‹åï¼Œé€šè¿‡ PostTask è½¬å‘åˆ° Chromium çš„äº‹ä»¶å¾ªç¯ä¸­

ä¸Šè¿°2ä¸ªæ­¥éª¤å®Œæˆäº† Electron çš„äº‹ä»¶å¾ªç¯ã€‚



## å››ã€ å¦‚ä½•è°ƒè¯•

è°ƒè¯•åˆ†ä¸ºä¸»è¿›ç¨‹è°ƒè¯•å’Œæ¸²æŸ“è¿›ç¨‹è°ƒè¯•ã€‚



### 1. æ¸²æŸ“è¿›ç¨‹è°ƒè¯•

çœ‹åˆ° Demo å·¥ç¨‹ä¸­æ‰§è¡Œ `npm start` ä¹‹åå¯ä»¥çœ‹åˆ°ä¸»ç•Œé¢ï¼ŒMac ç«¯å¿«æ·é”® `comand + option + i`ï¼Œå”¤å‡ºè°ƒè¯•ç•Œé¢ï¼Œç±»ä¼¼äº chrome ä¸‹çš„ devtoolsã€‚å…¶å®å°±æ˜¯æ— å¤´æµè§ˆå™¨çš„é‚£äº›ä¸œè¥¿ã€‚æˆ–è€…åœ¨ä»£ç é‡Œæ‰“å¼€è°ƒè¯•æ¨¡å¼ `mainWindow.webContents.openDevTools()` ã€‚

å·¥ç¨‹é‡‡ç”¨ Electron + Vue æŠ€æœ¯ï¼Œä¸‹é¢æˆªå›¾ Vue-devtools å¾ˆæ–¹ä¾¿æŸ¥çœ‹ Vue ç»„ä»¶å±‚çº§ç­‰ Vue ç›¸å…³çš„è°ƒè¯•

![æ¸²æŸ“è¿›ç¨‹è°ƒè¯•](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-04-ElectronVue.png)

### 2. ä¸»è¿›ç¨‹è°ƒè¯•æ–¹å¼

ä¸»è¿›ç¨‹è°ƒè¯•æœ‰2ç§æ–¹æ³•

æ–¹æ³•ä¸€ï¼šåˆ©ç”¨ chrome inspect åŠŸèƒ½è¿›è¡Œè°ƒè¯•

- éœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™ç»™ `package.json` ä¸­çš„ scripts èŠ‚ç‚¹ä¸‹çš„ start å‘½ä»¤åŠ ä¸Šè°ƒè¯•å¼€å…³
```shell
--inspect=[port]
// electrom --inspect=8001 yourApp
```
- ç„¶åæ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨åœ°å€æ è¾“å…¥ `chrome://inspect`
- ç‚¹å‡» `configure`ï¼Œåœ¨å¼¹å‡ºçš„é¢æ¿ä¸­å¡«å†™éœ€è¦è°ƒè¯•çš„ç«¯å£ä¿¡æ¯
 ![chrome inspect](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-04-21-electronChromeInspect.png)
- é‡æ–°å¼€å¯æœåŠ¡ `npm start`ï¼Œåœ¨ chrome inspect é¢æ¿çš„ `Target` èŠ‚ç‚¹ä¸­é€‰æ‹©éœ€è¦è°ƒè¯•çš„é¡µé¢
- åœ¨é¢æ¿ä¸­å¯ä»¥çœ‹åˆ°ä¸»è¿›ç¨‹æ‰§è¡Œçš„ `main.js`ã€‚å¯ä»¥åŠ æ–­ç‚¹è¿›è¡Œè°ƒè¯•
  ![chrome inspect](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-04-21-electron-MainProcessInspect.png)

æ–¹æ³•äºŒï¼šåˆ©ç”¨ VS Code è°ƒè¯• electron ä¸»è¿›ç¨‹ã€‚

- åœ¨ VS Code çš„å·¦ä¾§èœå•æ ï¼Œç¬¬å››ä¸ªåŠŸèƒ½æ¨¡å—å°±æ˜¯è°ƒè¯•ï¼Œç‚¹å‡»è°ƒè¯•ï¼Œå¼¹å‡ºå¯¹è¯æ¡†è®©ä½ æ·»åŠ è°ƒè¯•é…ç½®æ–‡ä»¶ `launch.json` 

- ç¼–è¾‘ launch.json çš„æ–‡ä»¶å†…å®¹ã€‚å¦‚ä¸‹

  ```json
  {
      "version": "0.2.0",
      "configurations": [
          {
              "type": "node",
              "request": "launch",
              "name": "Debug main process",
              "cwd": "${workspaceRoot}",
              "runtimeExecutable": "${workspaceRoot}/node_modules/.bin/electron",
              "windows": {
                  "runtimeExecutable": "${workspaceRoot}/node_modules/.bin/electron.cmd"
              },
              "args": ["."],
              "outputCapture": "std"
          }
      ]
  }
  ```

- åœ¨è°ƒè¯•æ¨¡å—ç”µæœºç»¿è‰²å°ä¸‰è§’ï¼Œä¼šè¿è¡Œç¨‹åºï¼Œå¯ä»¥æ·»åŠ æ–­ç‚¹ä¿¡æ¯ã€‚æ•´ä½“ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºã€‚å¯ä»¥å•æ­¥è°ƒè¯•ã€å¯ä»¥æš‚åœã€é¼ æ ‡ç§»ä¸Šå»å¯ä»¥çœ‹åˆ°å¯¹è±¡çš„å„ç§ä¿¡æ¯ã€‚

  ![VS Code è°ƒè¯•åŠŸèƒ½](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-04-21-electromDebugInVSCode.png)



### 3. ä¸»è¿›ç¨‹è°ƒè¯•ä¹‹ hot reload

Electron çš„æ¸²æŸ“è¿›ç¨‹ä¸­çš„ä»£ç æ”¹å˜äº†ï¼Œä½¿ç”¨ Command + R å¯ä»¥åˆ·æ–°ï¼Œä½†æ˜¯ä¿®æ”¹ä¸»è¿›ç¨‹ä¸­çš„ä»£ç åˆ™å¿…é¡»é‡æ–°å¯åŠ¨ `yarn run dev` ã€‚æ•ˆç‡ä½ä¸‹ï¼Œæ‰€ä»¥ä¸ºäº†æå‡å¼€å‘æ•ˆç‡ï¼Œæœ‰å¿…è¦è§£å†³è¿™ä¸ªé—®é¢˜

Webpack æœ‰ä¸€ä¸ª api: `watch-run`ï¼Œå¯ä»¥é’ˆå¯¹ä»£ç æ–‡ä»¶æ£€æµ‹ï¼Œæœ‰å˜åŒ–åˆ™ Restart

![main Process reload](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-04-ElectronMainProcessHotReload.png)



##  äº”ã€ å¼€å‘ tips

1. æˆ–è®¸ä¼šä¸ºç½‘é¡µæ·»åŠ äº‹ä»¶ä»£ç ï¼Œä½†æ˜¯é¡µé¢çœ‹åˆ°çš„å†…å®¹æ˜¯æ¸²æŸ“è¿›ç¨‹ï¼Œæ‰€ä»¥äº‹ä»¶ç›¸å…³çš„é€»è¾‘ä»£ç åº”è¯¥å†™åœ¨ html å¼•å…¥çš„ `render.js` ä¸­ã€‚  

2. åœ¨ `render.js` ä¸­å†™ Node ä»£ç çš„æ—¶å€™éœ€è¦åœ¨ `main.js`  åˆå§‹åŒ– BrowserWindow çš„æ—¶å€™ï¼Œåœ¨ webPreferences èŠ‚ç‚¹ä¸‹æ·»åŠ  `nodeIntegration: true` ã€‚ä¸ç„¶ä¼šæŠ¥é”™ï¼šrenderer.js:9 Uncaught ReferenceError: process is not definedã€‚

3. ä» Chrome Extenstion V2 å¼€å§‹ï¼Œä¸å…è®¸æ‰§è¡Œä»»ä½• inline javascript ä»£ç åœ¨ html ä¸­ã€‚ä¸æ”¯æŒä»¥å†…è”æ–¹å¼å†™äº‹ä»¶ç»‘å®šä»£ç ã€‚æ¯”å¦‚ `<button onclick="handleCPU">æŸ¥çœ‹</button>`

   ```shell
   Refused to execute inline event handler because it violates the following Content Security Policy directive: 
   ```

4. åˆ©ç”¨ electron è¿›è¡Œå¼€å‘çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹æˆæ˜¯ NodeJS + chromium + Web å‰ç«¯å¼€å‘æŠ€æœ¯ã€‚NodeJS æ‹¥æœ‰æ–‡ä»¶è®¿é—®ç­‰åç«¯èƒ½åŠ›ï¼Œchromium æä¾›å±•ç¤ºåŠŸèƒ½ï¼Œä»¥åŠç½‘ç»œèƒ½åŠ›ï¼ˆelectron ç½‘ç»œèƒ½åŠ›ä¸æ˜¯ NodeJS æä¾›çš„ï¼Œè€Œæ˜¯ chromium çš„ net æ¨¡å—æä¾›çš„ï¼‰ã€‚web å‰ç«¯å¼€å‘æŠ€æœ¯æ–¹æ¡ˆéƒ½å¯ä»¥åº”ç”¨åœ¨ electron ä¸­ï¼Œæ¯”å¦‚ Vueã€Reactã€Bootstrapã€sass ç­‰ã€‚

5. åœ¨å·¥ç¨‹åŒ–è§’åº¦çœ‹ï¼Œä½¿ç”¨ yarn æ¯” npm å¥½ä¸€äº›ï¼Œå› ä¸º yarn ä¼šç¼“å­˜å·²ç»å®‰è£…è¿‡çš„ä¾èµ–ï¼Œå…¶ä»–é¡¹ç›®åªè¦å‘ç°å­˜åœ¨ç¼“å­˜ï¼Œåˆ™è¯»å–æœ¬åœ°çš„åŒ…ä¾èµ–ï¼Œä¼šæ›´åŠ å¿«é€Ÿã€‚

6. åœ¨ä½¿ç”¨ Vueã€React å¼€å‘ electron åº”ç”¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ npm æˆ– yarn install åŒ…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ electron-vue è„šæ‰‹æ¶å·¥å…·ã€‚

   ```shell
   vue init simulatedgreg/electron-vue my-project
   cd my-project
   npm install
   npm run dev
   ```

7. å¼€å‘å®Œæ¯•åéœ€è¦è®¾ç½®åº”ç”¨ç¨‹åºçš„å›¾æ ‡ä¿¡æ¯ã€ç‰ˆæœ¬å·ç­‰ï¼Œæ‰“åŒ…éœ€è¦æŒ‡å®šä¸åŒçš„å¹³å°ã€‚

8. æ–°å¼€é¡¹ç›®åˆ›å»ºåä¼šæŠ¥é”™.
  - `ERROR in Template execution failed: ReferenceError: process is not defined`ã€‚è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ nvm å°† node ç‰ˆæœ¬å°†ä¸º 10ã€‚
  - æŠ¥é”™å¦‚ä¸‹
    ```shell
    â” Electron -------------------

    [11000:0615/095124.922:ERROR:CONSOLE(7574)] "Extension server error: Object not found: <top>", source: chrome-devtools://devtools/bundled/inspector.js (7574)
    
    â”— ----------------------------
    ```
    è§£å†³åŠæ³•æ˜¯åœ¨ main/index.dev.js ä¿®æ”¹ä»£ç 
    ```javascript
    - require('electron-debug')({ showDevTools: true });
    + // NB: Don't open dev tools with this, it is causing the error
    + require('electron-debug')();
    ```
    åœ¨ In main/index.js in the createWindow() function:
    ```javascript
    mainWindow.loadURL(winURL);
    +  // Open dev tools initially when in development mode
    +  if (process.env.NODE_ENV === "development") {
    +    mainWindow.webContents.on("did-frame-finish-load", () => {
    +      mainWindow.webContents.once("devtools-opened", () => {
    +        mainWindow.focus();
    +      });
    +      mainWindow.webContents.openDevTools();
    +    });
    +  }
    ```


9. Electron å¤šçª—å£ä¸å•çª—å£åº”ç”¨åŒºåˆ«

   ![ç”¨é€”](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-03-ElectronUsage.png)

10. çŸ¥é“ Electron å¼€å‘åŸç†ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ—¶é—´æ˜¯åœ¨å†™å‰ç«¯ä»£ç ã€‚æ‰€ä»¥æ ¹æ®å›¢é˜ŸæŠ€æœ¯æ²‰æ·€ã€é€‰æ‹©å¯¹åº”çš„å‰ç«¯æ¡†æ¶ï¼Œæ¯”å¦‚ Vueã€Reactã€Angularã€‚

11. ä¹Ÿè®¸å¼€å‘å¹¶ä¸éš¾ï¼Œéš¾åœ¨è§†è§‰å’Œ UXã€‚å¾ˆå¤šå†™è¿‡ç½‘é¡µçš„å¼€å‘è€…æˆ–è€…ä»¥å‰ç«¯çš„è§†è§‰å»å†™ Electron App éš¾å…ä¼šå†™å‡ºç½‘é¡µç‰ˆçš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼Œè¯´éš¾å¬ç‚¹ï¼Œå°±æ˜¯å››ä¸åƒ ğŸ˜‚ã€‚æ‰€ä»¥éœ€è¦è½¬å˜æƒ³æ³•ï¼Œè¿™æ˜¯åœ¨å¼€å‘æ¡Œé¢åº”ç”¨ç¨‹åºã€‚

12. Electron å’Œ Web å¼€å‘ç›¸æ¯”ï¼Œå„è‡ªæœ‰ä¾§é‡ç‚¹

    ![electronAndWeb](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-04-ElectronAndWeb.png)



## å…­ã€ æŠ€æœ¯ä½“ç³»æ­å»º

å…¶å®ä¸€ä¸ªæŠ€æœ¯æœ¬èº«çš„éš¾æ˜“ç¨‹åº¦å¹¶ä¸æ˜¯èƒ½å¦åœ¨è‡ªå·±ä¼ä¸šã€å…¬å¸ã€å›¢é˜Ÿå†…é¡ºåˆ©ä½¿ç”¨çš„å”¯ä¸€æ ‡å°ºï¼Œå…¶é…å¥—çš„ CI/CDã€APMã€åŸ‹ç‚¹ç³»ç»Ÿã€å‘å¸ƒæ›´æ–°ã€ç°åº¦æµ‹è¯•ç­‰èƒ½å¦ä¸ç°æœ‰çš„ç³»ç»Ÿä»¥è¾ƒå°æˆæœ¬èåˆæ‰æ˜¯å¾ˆå¤§çš„å†³å®šè¦ç´ ã€‚å› ä¸ºæŸä¸ªæŠ€æœ¯å¹¶ä¸æ˜¯éå¸¸éš¾ï¼Œè¦æ˜¯å¤§å¤šæ•°å¼€å‘è€…è§‰å¾—å¾ˆéš¾ï¼Œé‚£å®ƒè®¾è®¡ä¸Šå°±æ˜¯å¤±è´¥çš„ã€‚

### 1.  æ„å»º

![æ„å»º](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-04-ElectronBuild.png)



### 2. å·¥ç¨‹è§£è€¦

![å·¥ç¨‹è§£è€¦](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-04-ElectronCode.png)



### 3. é—®é¢˜å®šä½

Electron æä¾›çš„ crash ä¿¡æ¯è¿›è¡ŒåŒ…è£…ã€‚

![crash åˆ†æ](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-05-04-ElectronCrash.png)



å¼•ç”³èµ„æ–™

- [electron-vueæ¶æ„è§£æ-å¼€å‘ç¯å¢ƒå¯åŠ¨æµç¨‹åˆ†æ](https://dushaofeng.github.io/2018/06/08/electron-vueæ¶æ„è§£æ-å¼€å‘ç¯å¢ƒå¯åŠ¨æµç¨‹åˆ†æ/)

