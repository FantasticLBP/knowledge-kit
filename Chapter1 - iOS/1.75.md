# å†™å¥½æµ‹è¯•ï¼Œæå‡åº”ç”¨è´¨é‡

> ç›¸ä¿¡åœ¨å›½å†…ä¸€äº›ä¸­å°å‹å…¬å¸ï¼Œå¼€å‘è€…å¾ˆå°‘ä¼šå»å†™è½¯ä»¶æµ‹è¯•ç›¸å…³çš„ä»£ç ã€‚å½“ç„¶è¿™èƒŒåæœ‰ä¸€äº›åŸå› åœ¨ã€‚æœ¬æ–‡å°±è®²è®² iOS å¼€å‘ä¸­çš„è½¯ä»¶æµ‹è¯•ç›¸å…³çš„å†…å®¹ã€‚

## ä¸€ã€ æµ‹è¯•çš„é‡è¦æ€§

æµ‹è¯•å¾ˆé‡è¦ï¼æµ‹è¯•å¾ˆé‡è¦ï¼æµ‹è¯•å¾ˆé‡è¦ï¼é‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚

åœºæ™¯1ï¼šæ¯æ¬¡æˆ‘ä»¬å†™å®Œä»£ç åéƒ½éœ€è¦ç¼–è¯‘è¿è¡Œï¼Œä»¥æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„è¡¨ç°æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚å‡å¦‚æ”¹åŠ¨ç‚¹ã€ä»£ç é‡å°ï¼Œé‚£éªŒè¯æˆæœ¬ä½ä¸€äº›ï¼Œå‡å¦‚ä¸ç¬¦åˆé¢„æœŸï¼Œåˆ™è¯´æ˜æˆ‘ä»¬çš„ä»£ç æœ‰é—®ï¼Œäººå·¥å»æ’æŸ¥é—®é¢˜èŠ±è´¹çš„æ—¶é—´ä¹Ÿå°‘ä¸€äº›ã€‚å‡å¦‚æ”¹åŠ¨ç‚¹å¾ˆå¤šã€å—å½±å“çš„åœ°æ–¹è¾ƒå¤šï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ¢³ç†ç›¸å…³å½±å“ç‚¹ï¼Œç„¶åå»å®šä½é—®é¢˜ã€æ’æŸ¥é—®é¢˜çš„æˆæœ¬å°±å¾ˆé«˜ã€‚

åœºæ™¯2ï¼šä½ æ–°æ¥æ‰‹çš„ SDK æŸä¸ªå­åŠŸèƒ½éœ€è¦åšä¸€æ¬¡æŠ€æœ¯é‡æ„ã€‚ä½†æ˜¯ä½ åªæœ‰åœ¨å…¬å¸å†…éƒ¨çš„ä»£ç æ‰˜ç®¡å¹³å°ä¸Šå¯ä»¥çœ‹åˆ°ä¸€äº› Readmeã€æ¥å…¥æ–‡æ¡£ã€ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ã€æŠ€æœ¯æ–¹æ¡ˆè¯„ä¼°æ–‡æ¡£ç­‰ä¸€å †æ–‡æ¡£ã€‚å¯èƒ½ä½ ä¼šçœ‹å®Œå†å»åŠ¨æ‰‹é‡æ„ã€‚å½“ä½ é‡æ„å®Œäº†ï¼Œæ‰¾äº†å…¬å¸æŸæ¡ä¸šåŠ¡çº¿çš„ App æ¥å…¥æµ‹è¯•ï¼Œç‚¹äº†å‡ ä¸‹å‘ç°å‘ç”Ÿäº†å¥”æºƒã€‚ğŸ˜‚ å¿ƒæƒ³ï¼Œæœ¬åœ°æµ‹è¯•ã€debug éƒ½æ­£å¸¸å¯æ˜¯ä¸ºä»€ä¹ˆæ¥å…¥åå°± Crash äº†ã€‚å…¶å®æƒ³æƒ³ä¹Ÿå¥½ç†è§£ï¼Œä½ æœ¬åœ°é‡æ„åªæ˜¯ç¡®ä¿äº†ä½ å¼€å‘çš„é‚£ä¸ªåŠŸèƒ½è¿è¡Œæ­£å¸¸ï¼Œä½ å¾ˆéš¾ç¡®ä¿ä½ å†™çš„ä»£ç æ²¡æœ‰å½±å“å…¶ä»–ç±»ã€å…¶ä»–åŠŸèƒ½ã€‚å‡å¦‚ä¹‹å‰çš„ SDK é’ˆå¯¹æ¯ä¸ªç±»éƒ½æœ‰å•å…ƒæµ‹è¯•ä»£ç ï¼Œé‚£ä½ åœ¨æ–°åŠŸèƒ½å¼€å‘å®Œæ¯•åå®Œæ•´è·‘ä¸€æ¬¡å•å…ƒæµ‹è¯•ä»£ç å°±å¥½äº†ï¼Œä¿è¯æ¯ä¸ª Unit Test éƒ½é€šè¿‡ã€åˆ†æ”¯è¦†ç›–ç‡è¾¾åˆ°çº¦å®šçš„å€¼ï¼Œé‚£åŸºæœ¬ä¸Šæ˜¯æ²¡é—®é¢˜çš„ï¼Œæˆ–è€…è¯´è¯´é—®é¢˜çš„æ¦‚ç‡éå¸¸ä½äº†ã€‚

åœºæ™¯3ï¼šåœ¨ç‰ˆæœ¬è¿­ä»£çš„æ—¶å€™ï¼Œè®¡åˆ’åŠŸèƒ½ Aï¼Œä»å¼€å‘ã€è”è°ƒã€æµ‹è¯•ã€ä¸Šçº¿å…±2å‘¨æ—¶é—´ã€‚è€å¸æœºåšäº‹å¾ˆè‡ªä¿¡ï¼Œè¿™ä¹ˆç®€å•çš„ UIã€åŠ¨ç”»ã€äº¤äº’ï¼Œä»£ç é£éªšï¼Œå‚è€ƒæœåŠ¡ç«¯çš„ã€Œé¢†åŸŸé©±åŠ¨ã€åœ¨è¯¥ feature å¼€å‘é˜¶æ®µè½åœ°è¯•éªŒäº†ä¸‹ã€‚è”è°ƒã€æœ¬åœ°æµ‹è¯•éƒ½é€šè¿‡äº†ï¼Œè¿˜å‰©3å¤©æ—¶é—´ï¼Œæœ¬ä»¥ä¸ºæµ‹è¯•1å¤©ï¼Œbug fix ä¸€å¤©ï¼Œæœ€åä¸€å¤©æäº¤å®¡æ ¸ã€‚ä»£ç è·Ÿä½ å¼€äº†ä¸ªç©ç¬‘ï¼Œæµ‹è¯•å®Œ n ä¸ª bugï¼ˆå¤§å¤§è¶…å‡ºé¢„æœŸï¼‰ã€‚ä¸ºäº†ä¸å½±å“ App çš„å‘å¸ƒä¸Šæ¶ï¼Œä¸å¾—ä¸ç†¬å¤œä¿® bugã€‚å°†æ‰€æœ‰çš„æµ‹è¯•éƒ½é€šè¿‡æµ‹è¯•å·¥ç¨‹å¸ˆå»å¤„ç†ï¼Œè¿™ä¸ªé˜¶æ®µç†è®ºä¸Šè´¨é‡åº”è¯¥å¾ˆç¨³å®šï¼Œä¸ç„¶è¯¥é˜¶æ®µå‘ç°ä»£ç å¼‚å¸¸ã€æŠ€æœ¯è®¾è®¡æœ‰æ¼æ´å°±æ¥ä¸åŠäº†ï¼Œä½ éœ€è¦åè°ƒå„ä¸ªå›¢é˜Ÿçš„èµ„æºï¼ˆå¯èƒ½æ¥å£è¦æ”¹åŠ¨ã€äº§å“ä¾§è¦æ”¹åŠ¨ï¼‰ï¼Œè¿™ä¸ªé˜¶æ®µé€ æˆæ”¹åŠ¨çš„æˆæœ¬éå¸¸å¤§ã€‚

ç›¸ä¿¡å¤§å¤šæ•°å¼€å‘è€…éƒ½é‡åˆ°è¿‡ä¸Šè¿°åœºæ™¯çš„é—®é¢˜ã€‚å…¶å®ä¸Šè¿°è¿™å‡ ä¸ªé—®é¢˜éƒ½æœ‰è§£ï¼Œé‚£å°±æ˜¯â€œè½¯ä»¶æµ‹è¯•â€ã€‚

## äºŒã€è½¯ä»¶æµ‹è¯•

### 1. åˆ†ç±»

è½¯ä»¶æµ‹è¯•å°±æ˜¯åœ¨è§„å®šçš„æ¡ä»¶ä¸‹å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œæ“ä½œï¼Œä»¥å‘ç°ç¨‹åºé”™è¯¯ï¼Œè¡¡é‡è½¯ä»¶è´¨é‡ï¼Œå¹¶å¯¹å…¶æ˜¯å¦èƒ½æ»¡è¶³è®¾è®¡è¦æ±‚è¿›è¡Œè¯„ä¼°çš„è¿‡ç¨‹ã€‚

åˆç†åº”ç”¨è½¯ä»¶æµ‹è¯•æŠ€æœ¯ï¼Œå°±å¯ä»¥è§„é¿æ‰ç¬¬ä¸€éƒ¨åˆ†çš„3ä¸ªåœºæ™¯ä¸‹çš„é—®é¢˜ã€‚

è½¯ä»¶æµ‹è¯•å¼ºè°ƒå¼€å‘ã€æµ‹è¯•åŒæ­¥è¿›è¡Œï¼Œç”šè‡³æ˜¯æµ‹è¯•å…ˆè¡Œï¼Œä»éœ€æ±‚è¯„å®¡é˜¶æ®µå°±å…ˆè€ƒè™‘å¥½è½¯ä»¶æµ‹è¯•æ–¹æ¡ˆï¼Œéšåæ‰è¿›è¡ŒæŠ€æœ¯æ–¹æ¡ˆè¯„å®¡ã€å¼€å‘ç¼–ç ã€å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç³»ç»Ÿæµ‹è¯•ã€å›å½’æµ‹è¯•ã€éªŒæ”¶æµ‹è¯•ç­‰ã€‚

è½¯ä»¶æµ‹è¯•ä»æµ‹è¯•èŒƒå›´åˆ†ä¸ºï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç³»ç»Ÿæµ‹è¯•ã€å›å½’æµ‹è¯•ã€éªŒæ”¶æµ‹è¯•ï¼ˆæœ‰äº›å…¬å¸ä¼šè°ˆåˆ°â€œå†’çƒŸæµ‹è¯•â€œï¼Œè¿™ä¸ªè¯çš„ç²¾ç¡®å®šä¹‰ä¸çŸ¥é“ï¼Œä½†æ˜¯å­¦è½¯ä»¶æµ‹è¯•è¯¾çš„æ—¶å€™æŒ‰ç…§èŒƒå›´å°±åªæœ‰ä¸Šè¿°å‡ ä¸ªåˆ†ç±»ï¼‰ã€‚å·¥ç¨‹å¸ˆè‡ªå·±è´Ÿè´£çš„æ˜¯å•å…ƒæµ‹è¯•ã€‚æµ‹è¯•å·¥ç¨‹å¸ˆã€QA è´Ÿè´£çš„æ˜¯é›†æˆæµ‹è¯•ã€ç³»ç»Ÿæµ‹è¯•ã€‚

å•å…ƒæµ‹è¯•ï¼ˆUnit Testingï¼‰ï¼šåˆç§°ä¸ºæ¨¡å—æµ‹è¯•ï¼Œæ˜¯é’ˆå¯¹ç¨‹åºæ¨¡å—ï¼ˆè½¯ä»¶è®¾è®¡çš„æœ€å°å•ä½ï¼‰æ¥è¿›è¡Œæ­£ç¡®æ€§æ£€éªŒçš„æµ‹è¯•å·¥ä½œã€‚ã€Œå•å…ƒã€çš„æ¦‚å¿µä¼šæ¯”è¾ƒæŠ½è±¡ï¼Œå®ƒä¸ä»…ä»…æ˜¯æˆ‘ä»¬æ‰€ç¼–å†™çš„æŸä¸ªæ–¹æ³•ã€å‡½æ•°ï¼Œä¹Ÿå¯èƒ½æ˜¯æŸä¸ªç±»ã€å¯¹è±¡ç­‰ã€‚

è½¯ä»¶æµ‹è¯•ä»å¼€å‘æ¨¡å¼åˆ†ä¸ºï¼šé¢å‘æµ‹è¯•é©±åŠ¨å¼€å‘ TDD ï¼ˆTest-driven developmentï¼‰ã€é¢å‘è¡Œä¸ºé©±åŠ¨å¼€å‘ BDD ï¼ˆBehavior-driven developmentï¼‰ã€‚

### 2. TDD

TDD å¼€å‘è¿‡ç¨‹ç±»ä¼¼ä¸‹å›¾ï¼š

<a name="TDDStructure"></a>![](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-07-13-TDDStructure.png)

TDD çš„æ€æƒ³æ˜¯ï¼šå…ˆç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œå†å¿«é€Ÿå¼€å‘ä»£ç ï¼Œç„¶ååœ¨æµ‹è¯•ç”¨ä¾‹çš„ä¿è¯ä¸‹ï¼Œå¯ä»¥æ–¹ä¾¿å®‰å…¨åœ°è¿›è¡Œä»£ç é‡æ„ï¼Œæå‡åº”ç”¨ç¨‹åºçš„è´¨é‡ã€‚ä¸€è¨€ä»¥è”½ä¹‹å°±æ˜¯é€šè¿‡æµ‹è¯•æ¥æ¨åŠ¨å¼€å‘çš„è¿›è¡Œã€‚æ­£æ˜¯ç”±äºè¿™ä¸ªç‰¹ç‚¹ï¼ŒTDD è¢«å¹¿æ³›ä½¿ç”¨äºæ•æ·å¼€å‘ã€‚

ä¹Ÿå°±æ˜¯è¯´ TDD æ¨¡å¼ä¸‹ï¼Œé¦–å…ˆè€ƒè™‘å¦‚ä½•é’ˆå¯¹åŠŸèƒ½è¿›è¡Œæµ‹è¯•ï¼Œç„¶åå»ç¼–å†™ä»£ç å®ç°ï¼Œå†ä¸æ–­è¿­ä»£ï¼Œåœ¨æµ‹è¯•ç”¨ä¾‹çš„ä¿è¯ä¸‹ï¼Œä¸æ–­è¿›è¡Œä»£ç ä¼˜åŒ–ã€‚

TDD å¼ºè°ƒä¸æ–­çš„æµ‹è¯•æ¨åŠ¨ä»£ç çš„å¼€å‘ï¼Œä¿è¯äº†ä»£ç è´¨é‡ã€‚TDD å¼ºè°ƒè®©å†™ä»£ç çš„è¿‡ç¨‹å½¢æˆä¸€ä¸ªå¾ªç¯ï¼Œåœ¨æ‹¿åˆ°æ–°éœ€æ±‚æ—¶ï¼š

- ç¬¬ä¸€æ­¥ï¼šå…ˆä¸ºè¯¥åŠŸèƒ½ç¼–å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œè·‘ä¸€ä¸‹å‘ç°æ²¡æœ‰é€šè¿‡ï¼ˆè¿™æ—¶å€™è¿˜æ²¡æœ‰å®ç°ä»£ç ï¼‰ï¼Œå³å›¾ä¸­çš„ TEST FAILSï¼Œä¿—ç§°"çº¢ç¯"
- ç¬¬äºŒæ­¥ï¼šç¼–å†™èƒ½å¤Ÿé€šè¿‡å…¨éƒ¨æµ‹è¯•çš„â€œæœ€å°ä»£ç â€ï¼Œä¹‹æ‰€ä»¥å¼ºè°ƒâ€œæœ€å°ä»£ç â€ï¼Œå°±æ˜¯ä¸ºäº†é˜²æ­¢è¿‡åº¦ä¼˜åŒ–ï¼Œç°å®ä¸­æˆ‘ä»¬ç»å¸¸ä¼šå› ä¸ºä»£ç è¿‡åº¦ä¼˜åŒ–ï¼Œæˆ–è€…è¿‡åº¦è®¾è®¡ï¼Œå¯¼è‡´å¾ˆå¤šé—ç•™é—®é¢˜ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œå¿«é€Ÿå®ç°éœ€æ±‚å°±å¥½äº†ï¼Œä¸éœ€è¦å¤ªå¤šè®¾è®¡ã€‚è¿™ä¸ªé˜¶æ®µä¿—ç§°â€œç»¿ç¯â€
- ç¬¬ä¸‰æ­¥ï¼šä¹Ÿæ˜¯æœ€é‡æœ€è¦çš„ä¸€æ­¥ï¼Œå³â€œé‡æ„â€ï¼ˆRefactorï¼‰ã€‚å‰é¢ä¸ºäº†å¿«é€Ÿèµ¶ä¸šåŠ¡ï¼Œä»£ç è·¨å¹´å¾ˆè„ï¼ˆå±å±±ï¼‰ï¼Œä½†è‡³å°‘ä¿è¯æ˜¯æ­£ç¡®çš„ã€‚å½“æœ‰å……è¶³çš„æµ‹è¯•æ¥ä¿è¯é€»è¾‘çš„æ­£ç¡®ï¼Œè¿™æ—¶å€™å°±å¯ä»¥é‡æ„ä»£ç äº†ï¼ŒæŒç»­é‡æ„æ¥ä¿è¯ä»£ç æœ€ä¼˜ã€‚

è¿™ä¹Ÿå¾—å‡º2ä¸ªä¿¡æ¯ï¼š

1. å•æµ‹å¿…é¡»èƒ½å¤Ÿå¿«é€Ÿè¿è¡Œï¼Œå› ä¸ºå•æµ‹æ˜¯ç»å¸¸éœ€è¦åœ¨æœ¬åœ°å…¨é‡è¿è¡Œçš„ï¼Œåªæœ‰è¿è¡Œè¶³å¤Ÿå¿«ï¼Œæ‰å¯ä»¥åœ¨ TDD çš„å¾ªç¯ä¸­å¿«é€Ÿè¿­ä»£
2. å¥½çš„ä»£ç å¹¶ä¸æ˜¯ä¸€æ¬¡å®Œæˆçš„ï¼Œè€Œæ˜¯æŒç»­é‡æ„å‡ºæ¥çš„ï¼Œè€Œå•æµ‹æ˜¯æŒç»­é‡æ„çš„å‰æ



**æŠ›å‡ºä¸€ä¸ªé—®é¢˜ï¼šTDD çœ‹ä¸Šå»å¾ˆå¥½ï¼Œåº”è¯¥ç”¨å®ƒå—ï¼Ÿ**

è¿™ä¸ªé—®é¢˜ä¸ç”¨ç€æ€¥å›ç­”ï¼Œå›ç­”äº†ä¹Ÿä¸ä¼šæœ‰å¯¹é”™ä¹‹åˆ†ã€‚å¼€å‘ä¸­ç»å¸¸æ˜¯è¿™æ ·ä¸€ä¸ªæµç¨‹ï¼Œæ–°çš„éœ€æ±‚å‡ºæ¥åï¼Œå…ˆç»è¿‡æŠ€æœ¯è¯„å®¡ä¼šè®®ï¼Œç¡®å®šå®è§‚å±‚é¢çš„æŠ€æœ¯æ–¹æ¡ˆã€ç¡®å®šå„ä¸ªç«¯çš„æŠ€æœ¯å®ç°ã€ä½¿ç”¨çš„æŠ€æœ¯ç­‰ï¼Œæ•´ç†å‡ºå¼€å‘æ–‡æ¡£ã€ä¼šè®®æ–‡æ¡£ã€‚å·¥æœŸè¯„ä¼°åå¼€å§‹ç¼–ç ã€‚äº‹æƒ…è¿™ä¹ˆç®€å•å—ï¼Ÿå‰æœŸå³ä½¿æƒ³çš„å†å……åˆ†ã€å†ç»†è‡´ï¼Œå¯èƒ½è¿˜æ˜¯å­˜åœ¨ç‰¹æ®Š case æ¼æ‰çš„æƒ…å†µï¼Œå¯¼è‡´æŠ€æœ¯æ–¹æ¡ˆæˆ–è€…æ˜¯æŠ€æœ¯å®ç°çš„æ”¹å˜ã€‚å¦‚æœé‡‡ç”¨ TDDï¼Œé‚£ä¹ˆä¹‹å‰æ–°åŠŸèƒ½ç»™åˆ°åï¼Œå°±è¦è€ƒè™‘æµ‹è¯•ç”¨ä¾‹çš„è®¾è®¡ã€ç¼–å†™äº†æµ‹è¯•ä»£ç ï¼Œåœ¨æµ‹è¯•ç”¨ä¾‹çš„ä¿è¯ä¸‹å†å»å®ç°åŠŸèƒ½ã€‚å¦‚æœé‡åˆ°äº†æŠ€æœ¯æ–¹æ¡ˆçš„å˜æ›´ï¼Œä¹‹å‰çš„æµ‹è¯•ç”¨ä¾‹è¦æ”¹å˜ã€æµ‹è¯•ä»£ç å®ç°è¦æ”¹å˜ã€‚å¯èƒ½æ–°å¢çš„æŸä¸ª case å¯¼è‡´å¤§éƒ¨åˆ†çš„æµ‹è¯•ä»£ç å’Œå®ç°ä»£ç éƒ½è¦æ”¹å˜ã€‚

å¦‚ä½•å¼€å±• TDD**

1. æ–°å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œç¡®ä¿ â€œInclude Unit Testsâ€ é€‰é¡¹æ˜¯é€‰ä¸­çš„çŠ¶æ€

   ![TDD Step 1](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-07-13-TDDStep1.png)

2. åˆ›å»ºåçš„å·¥ç¨‹ç›®å½•å¦‚ä¸‹

   ![TDD step2](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-07-13-TDDStep2.png)

3. åˆ é™¤ Xcode åˆ›å»ºçš„æµ‹è¯•æ¨¡ç‰ˆæ–‡ä»¶ `TDDDemoTests.m`

4. å‡å¦‚æˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªäººç±»ï¼Œå®ƒå…·æœ‰åƒé¥­çš„åŠŸèƒ½ï¼Œä¸”å½“ä»–åƒå®Œåä¼šè¯´ä¸€å¥â€œå¥½é¥±å•Šâ€ã€‚

5. é‚£ä¹ˆæŒ‰ç…§ TDD æˆ‘ä»¬å…ˆè®¾è®¡æµ‹è¯•ç”¨ä¾‹ã€‚å‡è®¾æœ‰ä¸ª Person ç±»ï¼Œæœ‰ä¸ªå¯¹è±¡æ–¹æ³•å«åšåƒé¥­ï¼Œåƒå®Œé¥­åä¼šè¿”å›ä¸€ä¸ªâ€œå¥½é¥±å•Šâ€çš„å­—ç¬¦ä¸²ã€‚é‚£æµ‹è¯•ç”¨ä¾‹å°±æ˜¯

   | æ­¥éª¤                                    | æœŸæœ›               | ç»“æœ |
   | --------------------------------------- | ------------------ | ---- |
   | å®ä¾‹åŒ– Person å¯¹è±¡ï¼Œè°ƒç”¨å¯¹è±¡çš„ eat æ–¹æ³• | è°ƒç”¨åè¿”å›â€œå¥½é¥±å•Šâ€ | ï¼Ÿ   |

6. å®ç°æµ‹è¯•ç”¨ä¾‹ä»£ç ã€‚åˆ›å»ºç»§æ‰¿è‡ª Unit Test Case class çš„æµ‹è¯•ç±»ï¼Œå‘½åä¸º `å·¥ç¨‹å‰ç¼€+æµ‹è¯•ç±»å+Test`ï¼Œä¹Ÿå°±æ˜¯ `TDDPersonTest.m`ã€‚

   ![TDD step 3](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-07-13-TDDStep3.png)

7. å› ä¸ºè¦æµ‹è¯• Person ç±»ï¼Œæ‰€ä»¥åœ¨ä¸»å·¥ç¨‹ä¸­åˆ›å»º Person ç±» 

8. å› ä¸ºè¦æµ‹è¯•äººç±»åœ¨åƒé¥­åè¯´ä¸€å¥â€œå¥½é¥±å•Šâ€ã€‚æ‰€ä»¥è®¾æƒ³é‚£ä¸ªç±»ç›®å‰åªæœ‰ä¸€ä¸ªåƒé¥­çš„æ–¹æ³•ã€‚äºæ˜¯åœ¨ `TDDPersonTest.m` ä¸­åˆ›å»ºä¸€ä¸ªæµ‹è¯•å‡½æ•° `-(void)testReturnStatusStringWhenPersonAte;`å‡½æ•°å†…å®¹å¦‚ä¸‹

   ```objective-c
   - (void)testReturnStatusStringWhenPersonAte
   {
       // Given
       Person *somebody = [[Person alloc] init];
   
       // When
       NSString *statusMessage = [somebody performSelector:@selector(eat)];
   
       // Then
       XCTAssert([statusMessage isEqualToString:@"å¥½é¥±å•Š"], @"Person ã€Œåƒé¥­åè¿”å›â€œå¥½é¥±å•Šâ€ã€åŠŸèƒ½å¼‚å¸¸");
   }
   ```

9. Xcode ä¸‹æŒ‰å¿«æ·é”® `Command + U`,è·‘æµ‹è¯•ä»£ç å‘ç°æ˜¯å¤±è´¥çš„ã€‚å› ä¸ºæˆ‘ä»¬çš„ Person ç±»æ ¹æœ¬æ²¡å®ç°ç›¸åº”çš„æ–¹æ³•

10. ä» [TDD å¼€å‘è¿‡ç¨‹](#TDDStructure)å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç°åœ¨æ˜¯çº¢è‰²çš„ â€œFailâ€ çŠ¶æ€ã€‚æ‰€ä»¥éœ€è¦å» Person ç±»ä¸­å®ç°åŠŸèƒ½ä»£ç ã€‚Person ç±»å¦‚ä¸‹

    ```objective-c
    #import "Person.h"
    
    @implementation Person
    
    - (NSString *)eat
    {
        [NSThread sleepForTimeInterval:1];
        return @"å¥½é¥±å•Š";;
    }
    
    @end
    ```

11. å†æ¬¡è¿è¡Œï¼Œè·‘ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹(Command + U å¿«æ·é”®)ã€‚å‘ç°æµ‹è¯•é€šè¿‡ï¼Œä¹Ÿå°±æ˜¯[TDD å¼€å‘è¿‡ç¨‹](#TDDStructure)ä¸­çš„ç»¿è‰² â€œSuccessâ€ çŠ¶æ€ã€‚

12. ä¾‹å­æ¯”è¾ƒç®€å•ï¼Œå‡å¦‚æƒ…å†µéœ€è¦ï¼Œå¯ä»¥åœ¨ `-(void)setUp` æ–¹æ³•é‡Œé¢åšä¸€äº›æµ‹è¯•çš„å‰ç½®å‡†å¤‡å·¥ä½œï¼Œåœ¨ `-(void)tearDown` æ–¹æ³•é‡Œåšèµ„æºé‡Šæ”¾çš„æ“ä½œ

13. å‡å¦‚ eat æ–¹æ³•å®ç°çš„ä¸å¤Ÿæ¼‚äº®ã€‚ç°åœ¨åœ¨æµ‹è¯•ç”¨ä¾‹çš„ä¿è¯ä¸‹ï¼Œå¤§èƒ†é‡æ„ï¼Œæœ€åç¡®ä¿æ‰€æœ‰çš„ Unit Test case é€šè¿‡å³å¯ã€‚



### 3. BDD

BDD å³è¡Œä¸ºé©±åŠ¨å¼€å‘ï¼Œæ˜¯æ•æ·å¼€å‘**æŠ€æœ¯**ä¹‹ä¸€ï¼Œé€šè¿‡è‡ªç„¶è¯­è¨€å®šä¹‰ç³»ç»Ÿè¡Œä¸ºï¼Œä»¥åŠŸèƒ½ä½¿ç”¨è€…çš„è§’åº¦ï¼Œç¼–å†™éœ€æ±‚åœºæ™¯ï¼Œä¸”è¿™äº›è¡Œä¸ºæè¿°å¯ä»¥ç›´æ¥å½¢æˆéœ€æ±‚æ–‡æ¡£ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æµ‹è¯•æ ‡å‡†ã€‚

é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿæ‹†è§£æˆå“ªäº›å­é—®é¢˜ã€åšæˆè¿™ä¸ªäº‹æƒ…éœ€è¦å“ªäº›æ­¥éª¤ã€‚è¿™å°±æ˜¯ BDD çš„ç¼–å†™æµç¨‹ã€‚BDD ä½¿ç”¨ DSL ï¼ˆDomin Specific Languageï¼‰é¢†åŸŸç‰¹å®šè¯­è¨€æ¥æè¿°æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™æ ·ç¼–å†™çš„æµ‹è¯•ç”¨ä¾‹éå¸¸æ˜“è¯»ï¼Œçœ‹èµ·æ¥è·Ÿæ–‡æ¡£ä¸€æ ·æ˜“è¯»ï¼ŒBDD çš„ä»£ç ç»“æ„æ˜¯ `Given->When->Then`ã€‚



ç›¸æ¯” TDDï¼ŒBDD å…³æ³¨çš„æ˜¯è¡Œä¸ºæ–¹å¼çš„è®¾è®¡ï¼Œæ‹¿ä¸Šè¿°â€œäººåƒé¥­â€ä¸¾ä¾‹è¯´æ˜ã€‚

å’Œ TDD ç›¸æ¯”ç¬¬1ï½4æ­¥éª¤ç›¸åŒã€‚

5. BDD åˆ™éœ€è¦å…ˆå®ç°åŠŸèƒ½ä»£ç ã€‚åˆ›å»º Person ç±»ï¼Œå®ç° `-(void)eat;`æ–¹æ³•ã€‚ä»£ç å’Œä¸Šé¢çš„ç›¸åŒ

6. BDD éœ€è¦å¼•å…¥å¥½ç”¨çš„æ¡†æ¶ `Kiwi`ï¼Œä½¿ç”¨ Pod çš„æ–¹å¼å¼•å…¥

7. å› ä¸ºè¦æµ‹è¯•äººç±»åœ¨åƒé¥­åè¯´ä¸€å¥â€œå¥½é¥±å•Šâ€ã€‚æ‰€ä»¥è®¾æƒ³é‚£ä¸ªç±»ç›®å‰åªæœ‰ä¸€ä¸ªåƒé¥­çš„æ–¹æ³•ã€‚äºæ˜¯åœ¨ `TDDPersonTest.m` ä¸­åˆ›å»ºä¸€ä¸ªæµ‹è¯•å‡½æ•° `-(void)testReturnStatusStringWhenPersonAte;`å‡½æ•°å†…å®¹å¦‚ä¸‹

   ```objective-c
   #import "kiwi.h"
   #import "Person.h"
   
   SPEC_BEGIN(BDDPersonTest)
   
   describe(@"Person", ^{
       context(@"when someone ate", ^{
           it(@"should get a string",^{
                 Person *someone = [[Person alloc] init];
               NSString *statusMessage = [someone eat];
               [[statusMessage shouldNot] beNil];
               [[statusMessage should] equal:@"å¥½é¥±å•Š"];
           });
       });
   });
   
   SPEC_END
   ```



### 4. æ•æ·å¼€å‘

å¤§å¤šæ•°äººè§‰å¾—å†™ TDDã€BDD éƒ½ä¼šå½±å“å¼€å‘è¿­ä»£é€Ÿåº¦ï¼Œä½†æ˜¯ TDDã€BDD æ°æ°æ˜¯æ•æ·å¼€å‘å®è·µçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼š

![](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/Alige-devement-BDDAndTDD.png)

æˆ‘ä»¬å­¦ä¹ æ•æ·å¼€å‘çš„æ—¶å€™ï¼Œå¸¸å¸¸åªå­¦ä¹ åˆ°å®ƒçš„ â€œå¿«â€ï¼Œè€Œå¿½ç•¥äº†æ•æ·å¼€å‘æ‰€æå‡ºçš„è´¨é‡ä¿è¯æ–¹æ³•ã€‚æ•æ·å¼€å‘æ‰€è°“çš„â€œå¿«â€ï¼Œæ˜¯æŒ‡åœ¨ä»£ç è´¨é‡å……åˆ†ä¿è¯ä¸‹çš„â€œå¿«â€ï¼Œè€Œä¸æ˜¯åšå®ŒåŠŸèƒ½å°±ç›´æ¥ä¸Šçº¿ã€‚



### 5. é€‰ä»€ä¹ˆï¼Ÿ

çœ‹å®Œäº† TDD å’Œ BDDï¼Œé‚£æˆ‘ä»¬é€‰ä»€ä¹ˆï¼Ÿ

TDD é€‚åˆæ–°é¡¹ç›®ï¼Œä»0å¼€å§‹èµ·æ­¥å¼€å‘çš„ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„æ‰‹ä¸­çš„é¡¹ç›®åŸºæœ¬éƒ½æ˜¯å·²ç»è·‘äº†å¥½å‡ å¹´çš„ä¸šåŠ¡é¡¹ç›®ï¼ŒåŸºæœ¬ä¸Šæ²¡æœºä¼šå»å®æ–½ TDDã€‚

ä½†æ˜¯å¯¹äºç§»åŠ¨ä¸­å°æ¥è®²ï¼Œä¸€ä¸ªæ–°çš„æŠ€æœ¯ SDK æ˜¯æœ‰æœºä¼šè½åœ° TDD çš„ã€‚

è¿™é‡ŒèŠèŠå¤§å¤šæ•°çš„æƒ…å†µï¼Œå·²æœ‰çš„ä»£ç å¦‚ä½•å¼€å±•æµ‹è¯•ã€‚æˆ‘ä»¬é€‰æ‹© iOS å¹³å°è‡ªå¸¦çš„ XCTestã€‚æ­é…ä¸€äº›æµ‹è¯•æ¡†æ¶æ¥å¼€å±•ï¼Œæ¯”å¦‚ OCMock ç­‰

**å¼€å‘æ­¥éª¤**

Xcode è‡ªå¸¦çš„æµ‹è¯•ç³»ç»Ÿæ˜¯ `XCTest`ï¼Œä½¿ç”¨ç®€å•ã€‚å¼€å‘æ­¥éª¤å¦‚ä¸‹

- åœ¨ `Tests` ç›®å½•ä¸‹ä¸ºè¢«æµ‹çš„ç±»åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª `XCTestCase` çš„æµ‹è¯•ç±»ã€‚

- åˆ é™¤æ–°å»ºçš„æµ‹è¯•ä»£ç æ¨¡ç‰ˆé‡Œé¢çš„æ— ç”¨æ–¹æ³• `- (void)testPerformanceExample`ã€`- (void)testExample`ã€‚

- è·Ÿæ™®é€šç±»ä¸€æ ·ï¼Œå¯ä»¥ç»§æ‰¿ï¼Œå¯ä»¥å†™ç§æœ‰å±æ€§ã€ç§æœ‰æ–¹æ³•ã€‚æ‰€ä»¥å¯ä»¥åœ¨æ–°å»ºçš„ç±»é‡Œé¢ï¼Œæ ¹æ®éœ€æ±‚å†™ä¸€äº›ç§æœ‰å±æ€§ç­‰

- åœ¨ `- (void)setUp` æ–¹æ³•é‡Œé¢å†™ä¸€äº›åˆå§‹åŒ–ã€å¯åŠ¨è®¾ç½®ç›¸å…³çš„ä»£ç ã€‚æ¯”å¦‚æµ‹è¯•æ•°æ®åº“åŠŸèƒ½çš„æ—¶å€™ï¼Œå†™ä¸€äº›æ•°æ®åº“è¿æ¥æ± ç›¸å…³ä»£ç 

- ä¸ºè¢«æµ‹ç±»é‡Œé¢çš„æ¯ä¸ªæ–¹æ³•å†™æµ‹è¯•æ–¹æ³•ã€‚è¢«æµ‹ç±»é‡Œé¢å¯èƒ½æ˜¯ n ä¸ªæ–¹æ³•ï¼Œæµ‹è¯•ç±»é‡Œé¢å¯èƒ½æ˜¯ m ä¸ªæ–¹æ³•ï¼ˆm >= nï¼‰ï¼Œæ ¹æ®æˆ‘ä»¬åœ¨[ç¬¬ä¸‰éƒ¨åˆ†ï¼šå•å…ƒæµ‹è¯•ç¼–ç è§„èŒƒ](#codeRules)é‡Œè®²è¿‡çš„ **ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹åªæµ‹è¯•ä¸€ä¸ªåˆ†æ”¯**ï¼Œæ–¹æ³•å†…éƒ¨æœ‰ ifã€switch è¯­å¥æ—¶ï¼Œéœ€è¦ä¸ºæ¯ä¸ªåˆ†æ”¯å†™æµ‹è¯•ç”¨ä¾‹

- ä¸ºæµ‹è¯•ç±»æ¯ä¸ªæ–¹æ³•å†™çš„æµ‹è¯•æ–¹æ³•æœ‰ä¸€å®šçš„è§„èŒƒã€‚å‘½åå¿…é¡»æ˜¯ `test+è¢«æµ‹æ–¹æ³•å`ã€‚å‡½æ•°æ— å‚æ•°ã€æ— è¿”å›å€¼ã€‚æ¯”å¦‚ `- (void)testSharedInstance`ã€‚

- æµ‹è¯•æ–¹æ³•é‡Œé¢çš„ä»£ç æŒ‰ç…§ `Given->When->Then` çš„é¡ºåºå±•å¼€ã€‚æµ‹è¯•ç¯å¢ƒæ‰€éœ€çš„å…ˆå†³æ¡ä»¶å‡†å¤‡ï¼›è°ƒç”¨æ‰€è¦æµ‹è¯•çš„æŸä¸ªæ–¹æ³•ã€å‡½æ•°ï¼›ä½¿ç”¨æ–­è¨€éªŒè¯è¾“å‡ºå’Œè¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

- åœ¨ `- (void)tearDown` æ–¹æ³•é‡Œé¢å†™ä¸€äº›é‡Šæ”¾æ‰èµ„æºæˆ–è€…å…³é—­çš„ä»£ç ã€‚æ¯”å¦‚æµ‹è¯•æ•°æ®åº“åŠŸèƒ½çš„æ—¶å€™ï¼Œå†™ä¸€äº›æ•°æ®åº“è¿æ¥æ± å…³é—­çš„ä»£ç 

**æ–­è¨€ç›¸å…³å®**

```c++
/*!
 * @function XCTFail(...)
 * Generates a failure unconditionally.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTFail(...) \
    _XCTPrimitiveFail(self, __VA_ARGS__)

/*!
 * @define XCTAssertNil(expression, ...)
 * Generates a failure when ((\a expression) != nil).
 * @param expression An expression of id type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertNil(expression, ...) \
    _XCTPrimitiveAssertNil(self, expression, @#expression, __VA_ARGS__)

/*!
 * @define XCTAssertNotNil(expression, ...)
 * Generates a failure when ((\a expression) == nil).
 * @param expression An expression of id type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertNotNil(expression, ...) \
    _XCTPrimitiveAssertNotNil(self, expression, @#expression, __VA_ARGS__)

/*!
 * @define XCTAssert(expression, ...)
 * Generates a failure when ((\a expression) == false).
 * @param expression An expression of boolean type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssert(expression, ...) \
    _XCTPrimitiveAssertTrue(self, expression, @#expression, __VA_ARGS__)

/*!
 * @define XCTAssertTrue(expression, ...)
 * Generates a failure when ((\a expression) == false).
 * @param expression An expression of boolean type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertTrue(expression, ...) \
    _XCTPrimitiveAssertTrue(self, expression, @#expression, __VA_ARGS__)

/*!
 * @define XCTAssertFalse(expression, ...)
 * Generates a failure when ((\a expression) != false).
 * @param expression An expression of boolean type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertFalse(expression, ...) \
    _XCTPrimitiveAssertFalse(self, expression, @#expression, __VA_ARGS__)

/*!
 * @define XCTAssertEqualObjects(expression1, expression2, ...)
 * Generates a failure when ((\a expression1) not equal to (\a expression2)).
 * @param expression1 An expression of id type.
 * @param expression2 An expression of id type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertEqualObjects(expression1, expression2, ...) \
    _XCTPrimitiveAssertEqualObjects(self, expression1, @#expression1, expression2, @#expression2, __VA_ARGS__)

/*!
 * @define XCTAssertNotEqualObjects(expression1, expression2, ...)
 * Generates a failure when ((\a expression1) equal to (\a expression2)).
 * @param expression1 An expression of id type.
 * @param expression2 An expression of id type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertNotEqualObjects(expression1, expression2, ...) \
    _XCTPrimitiveAssertNotEqualObjects(self, expression1, @#expression1, expression2, @#expression2, __VA_ARGS__)

/*!
 * @define XCTAssertEqual(expression1, expression2, ...)
 * Generates a failure when ((\a expression1) != (\a expression2)).
 * @param expression1 An expression of C scalar type.
 * @param expression2 An expression of C scalar type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertEqual(expression1, expression2, ...) \
    _XCTPrimitiveAssertEqual(self, expression1, @#expression1, expression2, @#expression2, __VA_ARGS__)

/*!
 * @define XCTAssertNotEqual(expression1, expression2, ...)
 * Generates a failure when ((\a expression1) == (\a expression2)).
 * @param expression1 An expression of C scalar type.
 * @param expression2 An expression of C scalar type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertNotEqual(expression1, expression2, ...) \
    _XCTPrimitiveAssertNotEqual(self, expression1, @#expression1, expression2, @#expression2, __VA_ARGS__)

/*!
 * @define XCTAssertEqualWithAccuracy(expression1, expression2, accuracy, ...)
 * Generates a failure when (difference between (\a expression1) and (\a expression2) is > (\a accuracy))).
 * @param expression1 An expression of C scalar type.
 * @param expression2 An expression of C scalar type.
 * @param accuracy An expression of C scalar type describing the maximum difference between \a expression1 and \a expression2 for these values to be considered equal.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertEqualWithAccuracy(expression1, expression2, accuracy, ...) \
    _XCTPrimitiveAssertEqualWithAccuracy(self, expression1, @#expression1, expression2, @#expression2, accuracy, @#accuracy, __VA_ARGS__)

/*!
 * @define XCTAssertNotEqualWithAccuracy(expression1, expression2, accuracy, ...)
 * Generates a failure when (difference between (\a expression1) and (\a expression2) is <= (\a accuracy)).
 * @param expression1 An expression of C scalar type.
 * @param expression2 An expression of C scalar type.
 * @param accuracy An expression of C scalar type describing the maximum difference between \a expression1 and \a expression2 for these values to be considered equal.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertNotEqualWithAccuracy(expression1, expression2, accuracy, ...) \
    _XCTPrimitiveAssertNotEqualWithAccuracy(self, expression1, @#expression1, expression2, @#expression2, accuracy, @#accuracy, __VA_ARGS__)

/*!
 * @define XCTAssertGreaterThan(expression1, expression2, ...)
 * Generates a failure when ((\a expression1) <= (\a expression2)).
 * @param expression1 An expression of C scalar type.
 * @param expression2 An expression of C scalar type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertGreaterThan(expression1, expression2, ...) \
    _XCTPrimitiveAssertGreaterThan(self, expression1, @#expression1, expression2, @#expression2, __VA_ARGS__)

/*!
 * @define XCTAssertGreaterThanOrEqual(expression1, expression2, ...)
 * Generates a failure when ((\a expression1) < (\a expression2)).
 * @param expression1 An expression of C scalar type.
 * @param expression2 An expression of C scalar type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertGreaterThanOrEqual(expression1, expression2, ...) \
    _XCTPrimitiveAssertGreaterThanOrEqual(self, expression1, @#expression1, expression2, @#expression2, __VA_ARGS__)

/*!
 * @define XCTAssertLessThan(expression1, expression2, ...)
 * Generates a failure when ((\a expression1) >= (\a expression2)).
 * @param expression1 An expression of C scalar type.
 * @param expression2 An expression of C scalar type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertLessThan(expression1, expression2, ...) \
    _XCTPrimitiveAssertLessThan(self, expression1, @#expression1, expression2, @#expression2, __VA_ARGS__)

/*!
 * @define XCTAssertLessThanOrEqual(expression1, expression2, ...)
 * Generates a failure when ((\a expression1) > (\a expression2)).
 * @param expression1 An expression of C scalar type.
 * @param expression2 An expression of C scalar type.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertLessThanOrEqual(expression1, expression2, ...) \
    _XCTPrimitiveAssertLessThanOrEqual(self, expression1, @#expression1, expression2, @#expression2, __VA_ARGS__)

/*!
 * @define XCTAssertThrows(expression, ...)
 * Generates a failure when ((\a expression) does not throw).
 * @param expression An expression.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertThrows(expression, ...) \
    _XCTPrimitiveAssertThrows(self, expression, @#expression, __VA_ARGS__)

/*!
 * @define XCTAssertThrowsSpecific(expression, exception_class, ...)
 * Generates a failure when ((\a expression) does not throw \a exception_class).
 * @param expression An expression.
 * @param exception_class The class of the exception. Must be NSException, or a subclass of NSException.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertThrowsSpecific(expression, exception_class, ...) \
    _XCTPrimitiveAssertThrowsSpecific(self, expression, @#expression, exception_class, __VA_ARGS__)

/*!
 * @define XCTAssertThrowsSpecificNamed(expression, exception_class, exception_name, ...)
 * Generates a failure when ((\a expression) does not throw \a exception_class with \a exception_name).
 * @param expression An expression.
 * @param exception_class The class of the exception. Must be NSException, or a subclass of NSException.
 * @param exception_name The name of the exception.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertThrowsSpecificNamed(expression, exception_class, exception_name, ...) \
    _XCTPrimitiveAssertThrowsSpecificNamed(self, expression, @#expression, exception_class, exception_name, __VA_ARGS__)

/*!
 * @define XCTAssertNoThrow(expression, ...)
 * Generates a failure when ((\a expression) throws).
 * @param expression An expression.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertNoThrow(expression, ...) \
    _XCTPrimitiveAssertNoThrow(self, expression, @#expression, __VA_ARGS__)

/*!
 * @define XCTAssertNoThrowSpecific(expression, exception_class, ...)
 * Generates a failure when ((\a expression) throws \a exception_class).
 * @param expression An expression.
 * @param exception_class The class of the exception. Must be NSException, or a subclass of NSException.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertNoThrowSpecific(expression, exception_class, ...) \
    _XCTPrimitiveAssertNoThrowSpecific(self, expression, @#expression, exception_class, __VA_ARGS__)

/*!
 * @define XCTAssertNoThrowSpecificNamed(expression, exception_class, exception_name, ...)
 * Generates a failure when ((\a expression) throws \a exception_class with \a exception_name).
 * @param expression An expression.
 * @param exception_class The class of the exception. Must be NSException, or a subclass of NSException.
 * @param exception_name The name of the exception.
 * @param ... An optional supplementary description of the failure. A literal NSString, optionally with string format specifiers. This parameter can be completely omitted.
*/
#define XCTAssertNoThrowSpecificNamed(expression, exception_class, exception_name, ...) \
    _XCTPrimitiveAssertNoThrowSpecificNamed(self, expression, @#expression, exception_class, exception_name, __VA_ARGS__)
```

**ç»éªŒå°ç»“**

1. XCTestCase ç±»å’Œå…¶ä»–ç±»ä¸€æ ·ï¼Œä½ å¯ä»¥å®šä¹‰åŸºç±»ï¼Œè¿™é‡Œé¢å°è£…ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ã€‚

   ```
   // HCTTestCase.h
   #import <XCTest/XCTest.h>
   
   NS_ASSUME_NONNULL_BEGIN
   
   @interface HCTTestCase : XCTestCase
   
   @property (nonatomic, assign) NSTimeInterval networkTimeout;
   
   /// ç”¨ä¸€ä¸ªé»˜è®¤æ—¶é—´è®¾ç½®å¼‚æ­¥æµ‹è¯• XCTestExpectation çš„è¶…æ—¶å¤„ç†
   - (void)waitForExpectationsWithCommonTimeout;
   
   /**
   ç”¨ä¸€ä¸ªé»˜è®¤æ—¶é—´è®¾ç½®å¼‚æ­¥æµ‹è¯•çš„
   @param handler è¶…æ—¶çš„å¤„ç†é€»è¾‘
   */
   - (void)waitForExpectationsWithCommonTimeoutUsingHandler:(XCWaitCompletionHandler __nullable)handler;
   
   /**
   ç”Ÿæˆ Crash ç±»å‹çš„ meta æ•°æ®
   @return meta ç±»å‹çš„å­—å…¸
   */
   - (NSDictionary *)generateCrashMetaDataFromReport;
   
    @end
   
    NS_ASSUME_NONNULL_END
   
   // HCTTestCase.m
   #import "HCTTestCase.h"
   #import ...
   
   @implementation HCTTestCase
   
   #pragma mark - life cycle
   
   - (void)setUp {
       [super setUp];
       self.networkTimeout = 20.0;
       // 1. è®¾ç½®å¹³å°ä¿¡æ¯
       [self setupAppProfile];
       // 2. è®¾ç½® Mget é…ç½®
       [[TITrinityInitManager sharedInstance] setup];
       // ....
       // 3. è®¾ç½® HermesClient
       [[HermesClient sharedInstance] setup];
   }
   
   - (void)tearDown {
       [super tearDown];
   }
   
   #pragma mark - public Method
   - (void)waitForExpectationsWithCommonTimeout {
       [self waitForExpectationsWithCommonTimeoutUsingHandler:nil];
   }
   
   - (void)waitForExpectationsWithCommonTimeoutUsingHandler:(XCWaitCompletionHandler __nullable)handler {
       [self waitForExpectationsWithTimeout:self.networkTimeout handler:handler];
   }
   
   - (NSDictionary *)generateCrashMetaDataFromReport {
       NSMutableDictionary *metaDictionary = [NSMutableDictionary dictionary];
       NSDate *crashTime = [NSDate date];
       metaDictionary[@"MONITOR_TYPE"] = @"appCrash";
       // ...
       metaDictionary[@"USER_CRASH_DATE"] = @([crashTime timeIntervalSince1970] * 1000);
       return [metaDictionary copy];
   }
   
   #pragma mark - private method
   - (void)setupAppProfile {
       [[CMAppProfile sharedInstance] setMPlatform:@"70"];
       // ... 
   } 
   @end
   ```

2. ä¸Šè¿°è¯´çš„åŸºæœ¬æ˜¯å¼€å‘è§„èŒƒç›¸å…³ã€‚æµ‹è¯•æ–¹æ³•å†…éƒ¨å¦‚æœè°ƒç”¨äº†å…¶ä»–ç±»çš„æ–¹æ³•ï¼Œåˆ™åœ¨æµ‹è¯•æ–¹æ³•å†…éƒ¨å¿…é¡» Mock ä¸€ä¸ªå¤–éƒ¨å¯¹è±¡ï¼Œé™åˆ¶å¥½è¿”å›å€¼ç­‰ã€‚

3. åœ¨ XCTest å†…éš¾ä»¥ä½¿ç”¨ mock æˆ– stubï¼Œè¿™äº›æ˜¯æµ‹è¯•ä¸­éå¸¸å¸¸è§ä¸”é‡è¦çš„åŠŸèƒ½

**ä¾‹å­**

è¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼Œæ˜¯æµ‹è¯•ä¸€ä¸ªæ•°æ®åº“æ“ä½œç±» `HCTDatabase`ï¼Œä»£ç åªæ”¾æŸä¸ªæ–¹æ³•çš„æµ‹è¯•ä»£ç ã€‚

```objective-c
- (void)testRemoveLatestRecordsByCount {
    XCTestExpectation *exception = [self expectationWithDescription:@"æµ‹è¯•æ•°æ®åº“åˆ é™¤æœ€æ–°æ•°æ®åŠŸèƒ½"];
    // 1. å…ˆæ¸…ç©ºæ•°æ®è¡¨
    [dbInstance removeAllLogsInTableType:HCTLogTableTypeMeta];
    // 2. å†æ’å…¥ä¸€æ‰¹æ•°æ®
    NSMutableArray *insertModels = [NSMutableArray array];
    NSMutableArray *reportIDS = [NSMutableArray array];

    for (NSInteger index = 1; index <= 100; index++) {
        HCTLogMetaModel *model = [[HCTLogMetaModel alloc] init];
        model.log_id = index;
        // ...
        if (index > 90 && index <= 100) {
            [reportIDS addObject:model.report_id];
        }
        [insertModels addObject:model];
    }
    [dbInstance add:insertModels inTableType:HCTLogTableTypeMeta];

    // 3. å°†æ—©æœŸçš„æ•°æ®åˆ é™¤æ‰ï¼ˆid > 90 && id <= 100ï¼‰
    [dbInstance removeLatestRecordsByCount:10 inTableType:HCTLogTableTypeMeta];

    // 4. æ‹¿åˆ°å½“å‰çš„å‰10æ¡æ•°æ®å’Œä¹‹å‰å­˜èµ·æ¥çš„å‰10æ¡ id åšæ¯”è¾ƒã€‚å†åˆ¤æ–­å½“å‰è¡¨ä¸­çš„æ€»è®°å½•æ¡æ•°æ˜¯å¦ç­‰äº 90
    [dbInstance getLatestRecoreds:10 inTableType:HCTLogTableTypeMeta completion:^(NSArray<HCTLogModel *> * _Nonnull records) {
        NSArray<HCTLogModel *> *latestRTentRecords = records;

        [dbInstance getOldestRecoreds:100 inTableType:HCTLogTableTypeMeta completion:^(NSArray<HCTLogModel *> * _Nonnull records) {
            NSArray<HCTLogModel *> *currentRecords = records;

            __block BOOL isEarlyData = NO;
            [latestRTentRecords enumerateObjectsUsingBlock:^(HCTLogModel * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
                if ([reportIDS containsObject:obj.report_id]) {
                    isEarlyData = YES;
                }
            }];

            XCTAssert(!isEarlyData && currentRecords.count == 90, @"***Databaseã€Œåˆ é™¤æœ€æ–°næ¡æ•°æ®ã€åŠŸèƒ½ï¼šå¼‚å¸¸");
            [exception fulfill];
        }];

    }];
    [self waitForExpectationsWithCommonTimeout];
}
```

### 6. æµ‹è¯•æ¡†æ¶

#### 1. Kiwi

BDD æ¡†æ¶é‡Œçš„ Kiwi å¯åœˆå¯ç‚¹ã€‚ä½¿ç”¨ CocoaPods å¼•å…¥ `pod 'Kiwi'`ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­

è¢«æµ‹ç±»ï¼ˆPlanck é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº WebView çš„ SDKï¼Œæ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œå‘ç°é’ˆå¯¹ WebView çš„å¤§éƒ¨åˆ†åŠŸèƒ½å®šåˆ¶éƒ½æ˜¯åŸºäº WebView çš„ç”Ÿå‘½å‘¨æœŸå†…å‘ç”Ÿçš„ï¼Œæ‰€ä»¥å‚è€ƒ NodeJS çš„ä¸­é—´ä»¶æ€æƒ³ï¼Œè®¾è®¡äº†åŸºäºç”Ÿå‘½å‘¨æœŸçš„ WebView ä¸­é—´ä»¶ï¼‰

```objective-c
#import <Foundation/Foundation.h>

@interface TPKTrustListHelper : NSObject

+(void)fetchRemoteTrustList;

+(BOOL)isHostInTrustlist:(NSString *)scheme;

+(NSArray *)trustList;

@end
```

æµ‹è¯•ç±»

```objective-c
SPEC_BEGIN(TPKTrustListHelperTest)
describe(@"Middleware Wrapper", ^{

    context(@"when get trustlist", ^{
        it(@"should get a array of string",^{
            NSArray *array = [TPKTrustListHelper trustList];
            [[array shouldNot] beNil];
            NSString *first = [array firstObject];
            [[first shouldNot] beNil];
            [[NSStringFromClass([first class]) should] equal:@"__NSCFString"];
        });
    });

    context(@"when check a string wether contained in trustlist ", ^{
        it(@"first string should contained in trustlist",^{
            NSArray *array = [TPKTrustListHelper trustList];
            NSString *first = [array firstObject];
            [[theValue([TPKTrustListHelper isHostInTrustlist:first]) should] equal:@(YES)];
        });
    });
});
SPEC_END
```

ä¾‹å­åŒ…å« Kiwi çš„æœ€åŸºç¡€å…ƒç´ ã€‚`SPEC_BEGIN` å’Œ `SPEC_END` è¡¨ç¤ºæµ‹è¯•ç±»ï¼›`describe` æè¿°éœ€è¦è¢«æµ‹è¯•çš„ç±»ï¼›`context` è¡¨ç¤ºä¸€ä¸ªæµ‹è¯•åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯ `Given->When->Then` é‡Œçš„ `Given`ï¼›`it` è¡¨ç¤ºè¦æµ‹è¯•çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ä¹Ÿå°±æ˜¯ `Given->When->Then` é‡Œçš„ `When` å’Œ `Then`ã€‚1ä¸ª `describe` ä¸‹å¯ä»¥åŒ…å«å¤šä¸ª `context`ï¼Œ1ä¸ª `context` ä¸‹å¯ä»¥åŒ…å«å¤šä¸ª `it`ã€‚

Kiwi çš„ä½¿ç”¨åˆ†ä¸ºï¼š[Specs](https://github.com/kiwi-bdd/Kiwi/wiki/Specs)ã€ [Expectations](https://github.com/kiwi-bdd/Kiwi/wiki/Expectations) ã€ [Mocks and Stubs](https://github.com/kiwi-bdd/Kiwi/wiki/Mocks-and-Stubs) ã€[Asynchronous Testing](https://github.com/kiwi-bdd/Kiwi/wiki/Asynchronous-Testing) å››éƒ¨åˆ†ã€‚ç‚¹å‡»å¯ä»¥è®¿é—®è¯¦ç»†çš„è¯´æ˜æ–‡æ¡£ã€‚

`it` é‡Œé¢çš„ä»£ç å—æ˜¯çœŸæ­£çš„æµ‹è¯•ä»£ç ï¼Œä½¿ç”¨é“¾å¼è°ƒç”¨çš„æ–¹å¼ï¼Œç®€å•ä¸Šæ‰‹ã€‚

**æµ‹è¯•é¢†åŸŸä¸­ Mock å’Œ Stub éå¸¸é‡è¦ã€‚Mock æ¨¡æ‹Ÿå¯¹è±¡å¯ä»¥é™ä½å¯¹è±¡ä¹‹é—´çš„ä¾èµ–ï¼Œæ¨¡æ‹Ÿå‡ºä¸€ä¸ªçº¯å‡€çš„æµ‹è¯•ç¯å¢ƒï¼ˆç±»ä¼¼åˆä¸­ç‰©ç†è¯¾ä¸Šâ€œæ§åˆ¶å˜é‡æ³•â€çš„æ€æƒ³ï¼‰ã€‚Kiwi ä¹Ÿæ”¯æŒçš„éå¸¸å¥½ï¼Œå¯ä»¥æ¨¡æ‹Ÿå¯¹è±¡ã€æ¨¡æ‹Ÿç©ºå¯¹è±¡ã€æ¨¡æ‹Ÿéµå¾ªåè®®çš„å¯¹è±¡ç­‰ç­‰ï¼Œç‚¹å‡»  [Mocks and Stubs](https://github.com/kiwi-bdd/Kiwi/wiki/Mocks-and-Stubs) æŸ¥çœ‹ã€‚Stub å­˜æ ¹å¯ä»¥æ§åˆ¶æŸä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œè¿™å¯¹äºæ–¹æ³•å†…è°ƒç”¨åˆ«çš„å¯¹è±¡çš„æ–¹æ³•è¿”å›å€¼å¾ˆæœ‰å¸®åŠ©ã€‚å‡å°‘å¯¹äºå¤–éƒ¨çš„ä¾èµ–ï¼Œå•ä¸€æµ‹è¯•å½“å‰è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚**

é’ˆå¯¹å¼‚æ­¥æµ‹è¯•ï¼ŒXCTest åˆ™éœ€è¦åˆ›å»ºä¸€ä¸ª `XCTestExpectation` å¯¹è±¡ï¼Œåœ¨å¼‚æ­¥å®ç°é‡Œé¢è°ƒç”¨è¯¥å¯¹è±¡çš„ `fulfill` æ–¹æ³•ï¼Œæœ€åè®¾ç½®æœ€å¤§ç­‰å¾…æ—¶é—´å’Œå®Œæˆçš„å›è°ƒ `- (void)waitForExpectationsWithTimeout:(NSTimeInterval)timeout handler:(nullable XCWaitCompletionHandler)handler;` å¦‚ä¸‹ä¾‹å­

```
XCTestExpectation *exception = [self expectationWithDescription:@"æµ‹è¯•æ•°æ®åº“æ’å…¥åŠŸèƒ½"];
    [dbInstance removeAllLogsInTableType:HCTLogTableTypeMeta];
    NSMutableArray *insertModels = [NSMutableArray array];
    for (NSInteger index = 1; index <= 10000; index++) {
        HCTLogMetaModel *model = [[HCTLogMetaModel alloc] init];
        model.log_id = index;
          // ã€‚ã€‚ã€‚
        [insertModels addObject:model];
    }
    [dbInstance add:insertModels inTableType:HCTLogTableTypeMeta];
    [dbInstance recordsCountInTableType:HCTLogTableTypeMeta completion:^(NSInteger count) {
        XCTAssert(count == insertModels.count, @"**Databaseã€Œæ•°æ®å¢åŠ ã€åŠŸèƒ½ï¼šå¼‚å¸¸");
        [exception fulfill];
    }];
    [self waitForExpectationsWithCommonTimeout];
```

#### 2. expectaã€Specta

expecta å’Œ Specta éƒ½å‡ºè‡ª [orta](https://github.com/orta) ä¹‹æ‰‹ï¼Œä»–ä¹Ÿæ˜¯ Cocoapods çš„å¼€å‘è€…ä¹‹ä¸€ã€‚å¤ªç‰›é€¼äº†ï¼Œå·¥ç¨‹åŒ–ã€è´¨é‡ä¿è¯é¢†åŸŸçš„å¤§ä½¬ã€‚

Specta æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ BDD æµ‹è¯•æ¡†æ¶ï¼Œé‡‡ç”¨ DSL æ¨¡å¼ï¼Œè®©æµ‹è¯•æ›´æ¥è¿‘äºè‡ªç„¶è¯­è¨€ï¼Œå› æ­¤æ›´æ˜“è¯»ã€‚

ç‰¹ç‚¹ï¼š

- æ˜“äºé›†æˆåˆ°é¡¹ç›®ä¸­ã€‚åœ¨ Xcode ä¸­å‹¾é€‰ `Include Unit Tests` ï¼Œå’Œ XCTest æ­é…ä½¿ç”¨
- è¯­æ³•å¾ˆè§„èŒƒï¼Œå¯¹æ¯” Kiwi å’Œ Specta çš„æ–‡æ¡£ï¼Œå‘ç°å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯å¾ˆè§„èŒƒï¼Œæ‰€ä»¥å­¦ä¹ æˆæœ¬ä½ã€åæœŸè¿ç§»åˆ°å…¶ä»–æ¡†æ¶å¾ˆå¹³æ»‘ã€‚

Expecta æ˜¯ä¸€ä¸ªåŒ¹é…ï¼ˆæ–­è¨€ï¼‰æ¡†æ¶ï¼Œç›¸æ¯” Xcode çš„æ–­è¨€ XCAssertï¼ŒExcepta æä¾›æ›´åŠ ä¸°å¯Œçš„æ–­è¨€ã€‚

ç‰¹ç‚¹ï¼š

- Eepecta æ²¡æœ‰æ•°æ®ç±»å‹é™åˆ¶ï¼Œæ¯”å¦‚ 1ï¼Œå¹¶ä¸å…³å¿ƒæ˜¯ NSInteger è¿˜æ˜¯ CGFloat
- é“¾å¼ç¼–ç¨‹ï¼Œå†™èµ·æ¥å¾ˆèˆ’æœ
- åå‘åŒ¹é…ï¼Œå¾ˆçµæ´»ã€‚æ–­è¨€åŒ¹é…ç”¨ `except(...).to.equal(...)`ï¼Œæ–­è¨€ä¸åŒ¹é…åˆ™ä½¿ç”¨ `.notTo` æˆ–è€… `.toNot`
- å»¶æ—¶åŒ¹é…ï¼Œå¯ä»¥åœ¨é“¾å¼è¡¨è¾¾å¼ååŠ å…¥ `.will`ã€`.willNot`ã€`.after(interval)` ç­‰

#### 3. OCMock

ä½¿ç”¨ OCMock ç»å¸¸åšçš„äº‹æƒ…å°±æ˜¯å‡†å¤‡æ•°æ®ã€æ·»åŠ é¢„æœŸã€æ‰§è¡Œæ–­è¨€ã€‚å…·ä½“ç”¨æ³•å¯ä»¥æŸ¥çœ‹[æ–‡æ¡£](https://ocmock.org/reference/)ã€‚

ç®€å•çœ‹çœ‹åŸç†ã€‚

```
id mockObject = OCMClassMock([Person class]);
OCMStub([mockObject engineer]).andReturn(mockObject);
OCMStub([mockObject work]).andReturn(100);
// Assert
```

OCMClassMock å±•å¼€å¦‚ä¸‹

```
id mockObject = [OCMockObject niceMockForClass:[Person class]];
```

OCMockObject å…¶å®å°±æ˜¯ NSProxy çš„å­ç±»ï¼Œç”¨äºå®ç°æ¶ˆæ¯è½¬å‘ï¼Œ`niceMockForClass` å°±æ˜¯è°ƒç”¨äº†

```
+ (id)mockForClass:(Class)aClass {
    return [[[OCClassMockObject alloc] initWithClass:aClass] autorelease];
}
```

OCMStub æ˜¯ OCMock æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œ

```
({
    [OCMMacroState beginStubMacro];
    OCMStubRecorder *recorder = ((void *)0);
    @try{
        [mockObject work];
    } @finally {
        recorder = [OCMMacroState endStubMacro];
    }
    recorder;
});
```

ä¸Šé¢çš„ begin å’Œ end æ–¹æ³•å°±æ˜¯ä¸ºäº†å¢åŠ ä¸€ä¸ª OCMStubRecorder æ ‡è®°ï¼Œä¿å­˜åœ¨å½“å‰çº¿ç¨‹çš„å­—å…¸ä¸­

```
+ (void)beginStubMacro {
    OCMStubRecorder *recorder = [[[OCMStubRecorder alloc] init] autorelease];
    OCMMacroState *macroState = [[OCMMacroState alloc] initWithRecorder:recorder];
    [NSThread currentThread].threadDictionary[OCMGlobalStateKey] = macroState;
    [macroState release];
}

+ (OCMStubRecorder *)endStubMacro {
    NSMutableDictionary *threadDictionary = [NSThread currentThread].threadDictionary;
    OCMMacroState *globalState = threadDictionary[OCMGlobalStateKey];
    OCMStubRecorder *recorder = [(OCMStubRecorder *)[globalState recorder] retain];
    [threadDictionary removeObjectForKey:OCMGlobalStateKey];
    return [recorder autorelease];
}
```

å‰©ä¸‹çš„ä¸å±•å¼€è®²äº†ï¼Œä¸æ˜¯æœ¬æ–‡é‡ç‚¹ã€‚OCMock å…¶å®å°±æ˜¯åˆ©ç”¨ NSProxy å’Œ Runtime æ¶ˆæ¯è½¬å‘å»å®ç°çš„ã€‚



### 7.  å°ç»“

Xcode è‡ªå¸¦çš„ `XCTestCase` æ¯”è¾ƒé€‚åˆ TDDï¼Œä¸å½±å“æºä»£ç ï¼Œç³»ç»Ÿç‹¬ç«‹ä¸”ä¸å½±å“ App åŒ…å¤§å°ã€‚é€‚åˆç®€å•åœºæ™¯ä¸‹çš„æµ‹è¯•ã€‚ä¸”æ¯ä¸ªå‡½æ•°åœ¨æœ€å·¦ä¾§åˆä¸ªæµ‹è¯•æŒ‰é’®ï¼Œç‚¹å‡»åå¯ä»¥å•ç‹¬æµ‹è¯•æŸä¸ªå‡½æ•°ã€‚

Kiwi æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ BDD æ¡†æ¶ï¼Œé€‚åˆç¨å¾®å¤æ‚å†™çš„é¡¹ç›®ï¼Œå†™æ³•èˆ’æœã€åŠŸèƒ½å¼ºå¤§ï¼Œæ¨¡æ‹Ÿå¯¹è±¡ã€å­˜æ ¹è¯­æ³•ã€å¼‚æ­¥æµ‹è¯•ç­‰æ»¡è¶³å‡ ä¹æ‰€æœ‰çš„æµ‹è¯•åœºæ™¯ã€‚ä¸èƒ½å’Œ XCTest ç»§æ‰¿ã€‚

Specta ä¹Ÿæ˜¯ä¸€ä¸ª BDD æ¡†æ¶ï¼ŒåŸºäº XCTest å¼€å‘ï¼Œå¯ä»¥å’Œ XCTest æ¨¡ç‰ˆé›†åˆä½¿ç”¨ã€‚ç›¸æ¯” Kiwiï¼ŒSpecta è½»é‡ä¸€äº›ã€‚å¼€å‘ä¸­ä¸€èˆ¬æ­é… Excepta ä½¿ç”¨ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ Mock å’Œ Stud å¯ä»¥æ­é… OCMockã€‚

Excepta æ˜¯ä¸€ä¸ªåŒ¹é…æ¡†æ¶ï¼Œæ¯” XCTest çš„æ–­è¨€åˆ™æ›´åŠ å…¨é¢ä¸€äº›ã€‚

æ²¡åŠæ³•è¯´å“ªä¸ªæœ€å¥½ã€æœ€åˆç†ï¼Œæ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç»„åˆã€‚



## ä¸‰ã€ å•å…ƒæµ‹è¯•ç¼–ç è§„èŒƒ<a name="codeRules"></a>

æœ¬æ–‡çš„ä¸»è¦é‡ç‚¹æ˜¯é’ˆå¯¹æ—¥å¸¸å¼€å‘é˜¶æ®µå·¥ç¨‹å¸ˆå¯ä»¥åšçš„äº‹æƒ…ï¼Œä¹Ÿå°±æ˜¯å•å…ƒæµ‹è¯•è€Œå±•å¼€ã€‚

ç¼–å†™åŠŸèƒ½ã€ä¸šåŠ¡ä»£ç çš„æ—¶å€™ä¸€èˆ¬ä¼šéµå¾ª `kiss åŸåˆ™` ï¼Œæ‰€ä»¥ç±»ã€æ–¹æ³•ã€å‡½æ•°å¾€å¾€ä¸ä¼šå¤ªå¤§ï¼Œåˆ†å±‚è®¾è®¡è¶Šå¥½ã€èŒè´£è¶Šå•ä¸€ã€è€¦åˆåº¦è¶Šä½çš„ä»£ç è¶Šé€‚åˆåšå•å…ƒæµ‹è¯•ï¼Œå•å…ƒæµ‹è¯•ä¹Ÿå€’é€¼å¼€å‘è¿‡ç¨‹ä¸­ä»£ç åˆ†å±‚ã€è§£è€¦ã€‚

å¯èƒ½æŸä¸ªåŠŸèƒ½çš„å®ç°ä»£ç æœ‰30è¡Œï¼Œæµ‹è¯•ä»£ç æœ‰50è¡Œã€‚å•å…ƒæµ‹è¯•çš„ä»£ç å¦‚ä½•ç¼–å†™æ‰æ›´åˆç†ã€æ•´æ´ã€è§„èŒƒå‘¢ï¼Ÿ

### 1. ç¼–ç åˆ†æ¨¡å—å±•å¼€

å…ˆè´´ä¸€æ®µä»£ç ã€‚

```objective-c
-  (void)testInsertDataInOneSpecifiedTable {
    XCTestExpectation *exception = [self expectationWithDescription:@"æµ‹è¯•æ•°æ®åº“æ’å…¥åŠŸèƒ½"];
    // given
    [dbInstance removeAllLogsInTableType:HCTLogTableTypeMeta];
    NSMutableArray *insertModels = [NSMutableArray array];
    for (NSInteger index = 1; index <= 10000; index++) {
        HCTLogMetaModel *model = [[HCTLogMetaModel alloc] init];
        model.log_id = index;
                // ...
        [insertModels addObject:model];
    }
    // when
    [dbInstance add:insertModels inTableType:HCTLogTableTypeMeta];
       // then 
      [dbInstance recordsCountInTableType:HCTLogTableTypeMeta completion:^(NSInteger count) {
        XCTAssert(count == insertModels.count, @"ã€Œæ•°æ®å¢åŠ ã€åŠŸèƒ½ï¼šå¼‚å¸¸");
        [exception fulfill];
    }];
    [self waitForExpectationsWithCommonTimeout];
}
```

å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•çš„åç§°ä¸º testInsertDataInOneSpecifiedTableï¼Œè¿™æ®µä»£ç åšçš„äº‹æƒ…é€šè¿‡å‡½æ•°åå¯ä»¥çœ‹å‡ºæ¥ï¼šæµ‹è¯•æ’å…¥æ•°æ®åˆ°æŸä¸ªç‰¹å®šçš„è¡¨ã€‚è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹åˆ†ä¸º3éƒ¨åˆ†ï¼šæµ‹è¯•ç¯å¢ƒæ‰€éœ€çš„å…ˆå†³æ¡ä»¶å‡†å¤‡ï¼›è°ƒç”¨æ‰€è¦æµ‹è¯•çš„æŸä¸ªæ–¹æ³•ã€å‡½æ•°ï¼›éªŒè¯è¾“å‡ºå’Œè¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚

å…¶å®ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„ç¼–å†™ä¹Ÿè¦æŒ‰ç…§è¯¥ç§æ–¹å¼å»ç»„ç»‡ä»£ç ã€‚æ­¥éª¤åˆ†ä¸º3ä¸ªé˜¶æ®µï¼šGiven->When->Thenã€‚

æ‰€ä»¥å•å…ƒæµ‹è¯•çš„ä»£ç è§„èŒƒä¹Ÿå°±å‡ºæ¥äº†ã€‚æ­¤å¤–å•å…ƒæµ‹è¯•ä»£ç è§„èŒƒç»Ÿä¸€åï¼Œæ¯ä¸ªäººçš„æµ‹è¯•ä»£ç éƒ½æŒ‰ç…§è¿™ä¸ªæ ‡å‡†å±•å¼€ï¼Œé‚£å…¶ä»–äººçš„é˜…è¯»èµ·æ¥å°±æ›´åŠ å®¹æ˜“ã€æ–¹ä¾¿ã€‚æŒ‰ç…§è¿™3ä¸ªæ­¥éª¤å»é˜…è¯»ã€ç†è§£æµ‹è¯•ä»£ç ï¼Œå°±å¯ä»¥æ¸…æ™°æ˜äº†çš„çŸ¥é“åœ¨åšä»€ä¹ˆã€‚

### 2.  ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹åªæµ‹è¯•ä¸€ä¸ªåˆ†æ”¯

æˆ‘ä»¬å†™çš„ä»£ç æœ‰å¾ˆå¤šè¯­å¥ç»„æˆï¼Œæœ‰å„ç§é€»è¾‘åˆ¤æ–­ã€åˆ†æ”¯(if...elseã€swicth)ç­‰ç­‰ï¼Œå› æ­¤ä¸€ä¸ªç¨‹åºä»ä¸€ä¸ªå•ä¸€å…¥å£è¿›å»ï¼Œè¿‡ç¨‹å¯èƒ½äº§ç”Ÿ n ä¸ªä¸åŒçš„åˆ†æ”¯ï¼Œä½†æ˜¯ç¨‹åºçš„å‡ºå£æ€»æ˜¯ä¸€ä¸ªã€‚æ‰€ä»¥ç”±äºè¿™æ ·çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬çš„æµ‹è¯•ä¹Ÿéœ€è¦é’ˆå¯¹è¿™æ ·çš„ç°çŠ¶èµ°å®Œå°½å¯èƒ½å¤šçš„åˆ†æ”¯ã€‚ç›¸åº”çš„æŒ‡æ ‡å«åšã€Œåˆ†æ”¯è¦†ç›–ç‡ã€ã€‚

å‡å¦‚æŸä¸ªæ–¹æ³•å†…éƒ¨æœ‰ if...else...ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•çš„æ—¶å€™å°½é‡å°†æ¯ç§æƒ…å†µå†™æˆä¸€ä¸ªå•ç‹¬çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå•ç‹¬çš„è¾“å…¥ã€è¾“å‡ºï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚è¿™æ ·æ¯ä¸ª case éƒ½å•ä¸€çš„æµ‹è¯•æŸä¸ªåˆ†æ”¯ï¼Œå¯è¯»æ€§ä¹Ÿå¾ˆé«˜ã€‚

æ¯”å¦‚å¯¹ä¸‹é¢çš„å‡½æ•°åšå•å…ƒæµ‹è¯•ï¼Œæµ‹è¯•ç”¨ä¾‹è®¾è®¡å¦‚ä¸‹

```objective-c
- (void)shouldIEatSomething {
   BOOL shouldEat = [self getAteWeight] < self.dailyFoodSupport;
   if (shouldEat) {
     [self eatSomemuchFood];
   } else {
     [self doSomeExercise];
   }
}
```

Bad Caseï¼š

```objective-c
- (void)testShouldIEatSomething {
	// case1
  // case2
}
```

Good Caseï¼š

```objective-c
- (void)testShouldIEatSomethingWhenHungry {
   // ....
}

- (void)testShouldIEatSomethingWhenFull
{
  // ...
}
```

QAï¼šä¸€ä¸ªè¢«æµ‹æ–¹æ³•ï¼Œæœ‰è¯¸å¤š caseï¼Œä¸ºä»€ä¹ˆä¸å†™åœ¨ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ä¸­å°†è¿™äº› case å†™å…¨ï¼Ÿ

å› ä¸ºæµ‹è¯•æœ‰ä¸ªåŸåˆ™ï¼Œå°±æ˜¯æ¯ä¸ªæµ‹è¯• case éƒ½æ˜¯èƒ½å¤Ÿå•ç‹¬å¯è¿è¡Œçš„ã€‚å¦‚æœ2ä¸ªcaseéƒ½åœ¨ä¸€ä¸ªæ–¹æ³•å†…ï¼Œé‚£å°±ä¸æ˜¯å•ç‹¬å¯è¿è¡Œã€‚æ€ä¹ˆç†è§£ï¼Œè´´ä¸ªå›¾ï¼ˆç‚¹å‡»æœ€å·¦è¾¹çš„å°è±å½¢ï¼Œè¯¥ case æ˜¯éœ€è¦å•ç‹¬å¯è¿è¡Œçš„ï¼‰

![](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/UnitTest-FunctionStandard.png)

å†æœ‰ä¸€ä¸ªå‚ç…§ç‰©ï¼Œå¤§å®¶éƒ½åœ¨ç”¨çš„ ITerm2 çš„æºç æ˜¯å¼€æºçš„ï¼Œçœ‹çœ‹ ITerm2 æ˜¯å¦‚ä½•å†™æµ‹è¯•çš„

![](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/ITerm2-TestCase.png)

### 3. æ˜ç¡®æ ‡è¯†è¢«æµ‹è¯•ç±»

è¿™æ¡ä¸»è¦ç«™åœ¨å›¢é˜Ÿåˆä½œå’Œä»£ç å¯è¯»æ€§è§’åº¦å‡ºå‘æ¥è¯´æ˜ã€‚å†™è¿‡å•å…ƒæµ‹è¯•çš„äººéƒ½çŸ¥é“ï¼Œå¯èƒ½æŸä¸ªå‡½æ•°æœ¬æ¥å°±10è¡Œä»£ç ï¼Œå¯æ˜¯ä¸ºäº†æµ‹è¯•å®ƒï¼Œæµ‹è¯•ä»£ç å†™äº†30è¡Œã€‚ä¸€ä¸ªæ–¹æ³•è¿™æ ·å†™é—®é¢˜ä¸å¤§ï¼Œå¤šçœ‹çœ‹å°±çœ‹æ˜ç™½æ˜¯åœ¨æµ‹è¯•å“ªä¸ªç±»çš„å“ªä¸ªæ–¹æ³•ã€‚å¯æ˜¯å½“è¿™ä¸ªç±»æœ¬èº«å°±å¾ˆå¤§ï¼Œæµ‹è¯•ä»£ç å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œä¸ç®¡æ˜¯ä½œè€…è‡ªèº«è¿˜æ˜¯å¤šå¹´åè´Ÿè´£ç»´æŠ¤çš„å…¶ä»–åŒäº‹ï¼Œçœ‹è¿™ä¸ªä»£ç é˜…è¯»æˆæœ¬ä¼šå¾ˆå¤§ï¼Œéœ€è¦å…ˆçœ‹æµ‹è¯•æ–‡ä»¶å `ä»£ç ç±»å + Test` æ‰çŸ¥é“æ˜¯æµ‹è¯•çš„æ˜¯å“ªä¸ªç±»ï¼Œçœ‹æµ‹è¯•æ–¹æ³•å `test + æ–¹æ³•å` æ‰çŸ¥é“æ˜¯æµ‹è¯•çš„æ˜¯å“ªä¸ªæ–¹æ³•ã€‚

è¿™æ ·çš„ä»£ç å¯è¯»æ€§å¾ˆå·®ï¼Œæ‰€ä»¥åº”è¯¥ä¸ºå½“å‰çš„æµ‹è¯•å¯¹è±¡ç‰¹æ®Šæ ‡è®°ï¼Œè¿™æ ·æµ‹è¯•ä»£ç å¯è¯»æ€§è¶Šå¼ºã€é˜…è¯»æˆæœ¬è¶Šä½ã€‚æ¯”å¦‚å®šä¹‰å±€éƒ¨å˜é‡ `_sut` ç”¨æ¥æ ‡è®°å½“å‰è¢«æµ‹è¯•ç±»(sutï¼ŒSystem under  Testï¼Œè½¯ä»¶æµ‹è¯•é¢†åŸŸæœ‰ä¸ªè¯å«åš**è¢«æµ‹ç³»ç»Ÿ**ï¼Œç”¨æ¥è¡¨ç¤ºæ­£åœ¨è¢«æµ‹è¯•çš„ç³»ç»Ÿ)ã€‚

```objective-c
#import <XCTest/XCTest.h>
#import "HCTLogPayloadModel.h"

@interface HCTLogPayloadModelTest : HCTTestCase {
    HCTLogPayloadModel *_sut;
}

@end

@implementation HCTLogPayloadModelTest

- (void)setUp {
    [super setUp];
    HCTLogPayloadModel *model = [[HCTLogPayloadModel alloc] init];
    model.log_id = 1;
    // ...
    _sut = model;
}

- (void)tearDown {
    _sut = nil;
    [super tearDown];
}

- (void)testGetDictionary {
    NSDictionary *payloadDictionary = [_sut getDictionary];
    XCTAssert([(NSString *)payloadDictionary[@"report_id"] isEqualToString:@"001"] &&
              [payloadDictionary[@"size"] integerValue] == 102 &&
              [(NSString *)payloadDictionary[@"meta"] containsString:@"meiying"],
              @"HCTLogPayloadModel çš„ ã€ŒgetDictionaryã€åŠŸèƒ½å¼‚å¸¸");
}

@end
```

### 4.  ä½¿ç”¨åˆ†ç±»æ¥æš´éœ²ç§æœ‰æ–¹æ³•ã€ç§æœ‰å˜é‡

æŸäº›åœºæ™¯ä¸‹å†™çš„æµ‹è¯•æ–¹æ³•å†…éƒ¨å¯èƒ½éœ€è¦è°ƒç”¨è¢«æµ‹å¯¹è±¡çš„ç§æœ‰æ–¹æ³•ï¼Œä¹Ÿå¯èƒ½éœ€è¦è®¿é—®è¢«æµ‹å¯¹è±¡çš„æŸä¸ªç§æœ‰å±æ€§ã€‚ä½†æ˜¯æµ‹è¯•ç±»é‡Œé¢æ˜¯è®¿é—®ä¸åˆ°è¢«æµ‹ç±»çš„ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•çš„ï¼Œå€ŸåŠ©äº Runtime ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç»™è¢«æµ‹ç±»æ·»åŠ  **Category** æ¥è§£å†³æ— æ³•è®¿é—®ç§æœ‰æ–¹æ³•å’Œç§æœ‰å±æ€§çš„é—®é¢˜ã€‚

ä¸ºæµ‹è¯•ç±»æ·»åŠ ä¸€ä¸ªåˆ†ç±»ï¼Œåç¼€åä¸º `UnitTest`ã€‚å¦‚ä¸‹æ‰€ç¤º

 `HermesClient` ç±»æœ‰ç§æœ‰å±æ€§ `@property (nonatomic, strong) NSString *name;`ï¼Œç§æœ‰æ–¹æ³•  `- (void)hello`ã€‚ä¸ºäº†åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­è®¿é—®ç§æœ‰å±æ€§å’Œç§æœ‰æ–¹æ³•ï¼Œå†™äº†å¦‚ä¸‹åˆ†ç±»

```objective-c
@interface HermesClient : NSObject
@end
  
@interface HermesClient ()
@property (nonatomic, assign) int b;
@end

@implementation HermesClient
- (instancetype)init {
  if (self = [super init]) {
    self.b = 10;
  }
  return self;
}

- (int)add:(int)a {
  return a+b;
}
@end

// HermesClientTest.m
@interface HermesClient (UnitTest)
@property (nonatomic, assign) int b;
- (int)add:(int)a;
@end

@interface HermesClientTest() {
  	HermesClientTest *_sut;
}
@end
  
@implementation HermesClientTest
- (void)setUp {
	_sut = [[HermesClientTest alloc] init];
}
- (void)testAdd
{
   int result = [_sut add:20];
	 XCTAssert(result == 30,
              @"Oops, there is something wrong with add: method of HermesClientTest.");
}
@end
```

### 5.  å•æµ‹éœ€è¦ç¡®å®šæ€§

é¿å…è„†å¼±æµ‹è¯•ï¼ŒMockä¸ç¡®å®šçš„ä¾èµ–ï¼šæ—¶é—´ã€éšæœºæ•°ã€å¹¶å‘æ€§ã€åŸºç¡€è®¾æ–½ã€ç°å­˜æ•°æ®ã€æŒä¹…åŒ–ã€ç½‘ç»œç­‰ç­‰ã€‚ä¸€ä¸ª case åº”è¯¥åªé’ˆå¯¹æŸä¸ªé€»è¾‘åˆ†æ”¯è¿›è¡Œæµ‹è¯•ï¼Œé‚£ä¹ˆå¯¹äºç‰¹å®šè¾“å…¥ã€ä¸€å®šæœ‰ä¸€ä¸ªç‰¹å®šè¾“å‡ºï¼Œæ¥åˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ä¸ºæ­¤ï¼Œå…¶ä»–çš„å› ç´ éƒ½åº”è¯¥æ˜¯å”¯ä¸€ç¡®å®šçš„ï¼Œä¿è¯æµ‹è¯•ç¯å¢ƒçš„ç¡®å®šæ€§ã€‚

````objective-c
/// æµ‹è¯•æ•°æ®åº“çš„æŸ¥è¯¢æœ€æ–°ä¸€æ¡è®°å½•çš„èƒ½åŠ›
- (void)testSelectLastesRecord {
  // é¦–å…ˆéœ€è¦ä¿è¯æ•°æ®åº“åªæœ‰ä¸€äº›éœ€è¦çš„è®°å½•
	[_db clear];
  // æ’å…¥ä¸€æ‰¹å­¦ç”Ÿæ•°æ®ï¼Œå­¦å·ä»0åˆ°20è‡ªå¢
  [_db insertAutoIncrementStudent:studentModel count:20];
  
  Student *model = [_db selectLastesRecord];
  XCTAssert(model.Sno == 20, @"Oops, there is comething wrong with selectLastesRecord method of DB");
}
````

### 6. é¿å…è€—æ—¶æ“ä½œï¼Œå¯¼è‡´æµ‹è¯•æ‰§è¡Œç¼“æ…¢

å•æµ‹çš„ç›®çš„å°±æ˜¯ä¸ºäº†å¿«é€ŸéªŒè¯è¢«æµ‹ä»£ç çš„æ­£ç¡®æ€§ï¼Œå¦‚æœå¤§å®¶å†™æµ‹è¯•ä»£ç çš„æ—¶å€™ä¸æ³¨æ„ï¼ŒåŠ ä¸€äº› sleep ä¹‹ç±»çš„ä»£ç ï¼Œæ•´ä¸ªå•æµ‹å·¥ç¨‹è¿è¡Œå°±ä¼šå¾ˆæ…¢ï¼Œé—®é¢˜éªŒè¯æˆ–è€…æŸ¥çœ‹æ•´ä¸ªå·¥ç¨‹çš„è¦†ç›–ç‡å°±ä¼šå¾ˆæ…¢ã€‚

ä¸¾ä¸€ä¸ªå·¥ç¨‹ä¸­çš„ä¾‹å­ã€‚

```objc
// bad case
+ (OKFJsonRequest*)getHotTokensData:(NSString*)chainId walletId:(NSString * _Nonnull)walletId {
    OKFMockRequest* request = [OKFMockRequest mockRequestWithResponseJsonString:[MockData jsonStringFromFile:@"hot_token"]];
    request.mockResponseDuration = 0.1;
    return request;
}
```

ç½‘ç»œ Mock å·¥å…·ç±»ä¸­é’ˆå¯¹è¯·æ±‚è€—æ—¶éƒ½å†™äº† 0.1sï¼Œæ•´ä¸ªå·¥ç¨‹å°±ä¼šå¾ˆæ…¢ã€‚`mockResponseDuration` å­—æ®µæ˜¯ä¸ºäº†æ§åˆ¶å¼±ç½‘ç¯å¢ƒä¸‹çš„è¡¨ç°ï¼Œä½†æ˜¯çœ‹äº†æµ‹è¯•ä»£ç ï¼Œæ ¹æœ¬æ²¡æœ‰è¿™æ–¹é¢çš„æµ‹è¯•ã€‚æ‰€ä»¥ `mockResponseDuration` å¯ä»¥ä¸ç”¨è®¾ç½®ï¼Œé»˜è®¤å°±æ˜¯0.

### 7.  é¿å…è¿‡åº¦æŒ‡å®š

å¯¹äºè¿‡åº¦æŒ‡å®šçš„è®¨è®ºï¼Œå…¶æ ¸å¿ƒé—®é¢˜å°±æ˜¯è¦æˆ‘ä»¬ã€Œåˆ¤æ–­å“ªäº›æ–¹æ³•æ˜¯å•å…ƒæµ‹è¯•åº”è¯¥è¦†ç›–çš„ã€ï¼Œå“ªäº›æ˜¯åº”è¯¥ç•™ç»™å…¶ä»–æµ‹è¯•æ‰‹æ®µçš„ã€‚å¦‚æœä¸€ä¸ªåœºæ™¯ï¼Œå•å…ƒæµ‹è¯•è¦†ç›–ä¹‹åï¼Œç»å¸¸å¯¼è‡´å•æµ‹å¤±è´¥ï¼Œéœ€è¦ä¸æ–­æ›´æ–°ç»´æŠ¤ï¼Œé‚£å°±éœ€è¦ double check ä¸‹ï¼Œè¿™æ®µä»£ç æ˜¯ä¸æ˜¯å¯ä»¥è€ƒè™‘ä¸åšå•å…ƒæµ‹è¯•è¦†ç›–ã€‚ROI åˆé€‚å—ï¼Ÿ

åƒç´ å®Œç¾æ˜¯ä¸€ä¸ªå…¸å‹çš„ï¼Œç»å¸¸è¢«äººä»¬æ‹¿å‡ºæ¥èŠçš„ä¾‹å­ï¼ŒFlutter çš„ Golden Test å°±æ˜¯ä¸€ä¸ª golden master testing çš„ä¾‹å­ï¼›ä¸‹é¢æ˜¯ã€Šæœ‰æ•ˆçš„å•å…ƒæµ‹è¯•ã€‹ä¸­å…³äºåƒç´ å®Œç¾çš„è®¨è®ºï¼š

> åƒç´ å®Œç¾ï¼šé¡¾åæ€ä¹‰ï¼Œæ˜¯ä¸€ç§ç‰¹å®šäºå›¾å½¢å’Œå›¾åƒç”Ÿæˆçš„æµ‹è¯•åå‘³é“ã€‚å®ƒæ··æ‚äº†é­”æ³•æ•°å­—å’ŒåŸºæœ¬æ–­è¨€ï¼Œä½¿å¾—æµ‹è¯•æéš¾é˜…è¯»ä¹Ÿæå…¶è„†å¼±ã€‚
>
> è¿™ç§æµ‹è¯•å‡ ä¹æ— æ³•é˜…è¯»ï¼Œå› ä¸ºå³ä½¿æµ‹è¯•åœ¨è¯­ä¹‰ä¸Šæ˜¯å¤„äºé«˜å±‚æ¦‚å¿µçš„ï¼Œå´ä»ç„¶ä¼šé’ˆå¯¹ç¡¬ç¼–ç çš„åº•å±‚ç»†èŠ‚ä¾‹å¦‚åƒç´ åæ ‡å’Œé¢œè‰²æ¥è¿›è¡Œæ–­è¨€ã€‚æŒ‡å®šåæ ‡ä¸Šçš„åƒç´ æ˜¯é»‘è¿˜æ˜¯ç™½ï¼Œä¸ä¸¤ä¸ªå›¾å½¢æ˜¯å¦ç›¸è¿æˆ–å †å çš„æ¦‚å¿µæ˜¯æœ‰åŒºåˆ«çš„ã€‚
>
> è¿™ç§æµ‹è¯•æå…¶è„†å¼±ï¼Œå› ä¸ºå³ä½¿å¾ˆå°çš„å’Œä¸ç›¸å…³çš„è¾“å…¥å˜åŒ–â€”â€”æ˜¯å¦æ˜¯å¦ä¸€ä¸ªå›¾åƒï¼Œæˆ–å›¾å½¢å¯¹è±¡çš„æ¸²æŸ“æ–¹å¼â€”â€”éƒ½è¶³ä»¥å½±å“è¾“å‡ºã€æ‰“ç ´æµ‹è¯•ï¼Œè°è®©ä½ éè¦ç²¾ç¡®åœ°æ£€æŸ¥åƒç´ åæ ‡å’Œé¢œè‰²å‘¢ã€‚åŒæ ·çš„é—®é¢˜åœ¨é‡‡ç”¨golden masteræŠ€æœ¯æ—¶ä¹Ÿä¼šé‡åˆ°ï¼Œå…¶åšæ³•æ˜¯äº‹å…ˆå°†å›¾åƒå½•åˆ¶ä¸‹æ¥ï¼Œå¹¶æ‰‹å·¥æ£€æŸ¥å…¶æ­£ç¡®æ€§ï¼Œä»¥åå†è¿›è¡Œæµ‹è¯•æ—¶å°±å°†æ¸²æŸ“å‡ºçš„å›¾åƒä¸ä¹‹è¿›è¡Œæ¯”å¯¹ã€‚
>
> è¿™äº›å¯ä¸æ˜¯æˆ‘ä»¬æ„¿æ„å»ç»´æŠ¤çš„æµ‹è¯•ã€‚æˆ‘ä»¬ä¸å¸Œæœ›å¸¦ç€è¿™ç§è„†å¼±çš„ç²¾ç¡®åº¦å»ç¼–å†™æµ‹è¯•ï¼Œè€Œæ˜¯ä½¿ç”¨æ¨¡ç³ŠåŒ¹é…å’Œæ™ºèƒ½ç®—æ³•æ¥ä»£æ›¿ç¹ççš„æ•°å€¼æ¯”è¾ƒã€‚

### 8.  æµ‹è¯•ä¸è¦åä¸å‰¯å®

é¿å…æµ‹è¯•çš„æè¿°å’Œæµ‹è¯•å†…å®¹ä¸ç¬¦ï¼Œæµ‹è¯•ç»“æœå¿…é¡»ç²¾å‡†ï¼Œæµ‹è¯•æ–­è¨€ä¿¡æ¯ä¹Ÿéœ€è¦ç²¾å‡†ã€‚

```objective-c
// bad case
- (void)testDB {
	[_sut clear];
	[_sut insert:datasource];
	XCTAssert([_sut count] == datasource.count, @"Oops, there is something wrong with DB");
}
```

å•é€šè¿‡æ–¹æ³•åæ ¹æœ¬ä¸çŸ¥é“è¯¥æµ‹è¯•ç”¨ä¾‹æ˜¯åœ¨æµ‹è¯•ä»€ä¹ˆã€‚æ‰€ä»¥è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªåä¸å‰¯å®ã€‚

### 9. ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–­è¨€

æ–­è¨€çš„é”™è¯¯ä¿¡æ¯è¦æœ‰æ„ä¹‰ï¼Œå‡ºç°é—®é¢˜èƒ½å¤Ÿæ˜ç¡®é”™è¯¯çš„åŸå› 

```objective-c
// good case
- (void)testInsert {
	[_sut clear];
	[_sut insert:datasource];
	XCTAssert([_sut count] == datasource.count, @"Oops, there is something wrong with insert: method of DB.");
}
```

### 10. æ¸…ç†æµ‹è¯•ç¯å¢ƒ

åœ¨ teardown é˜¶æ®µæ¸…ç†æµ‹è¯•ç¯å¢ƒï¼Œä¾‹å¦‚è¿˜åŸå…¨å±€çš„é…ç½®ã€æ¸…ç†åˆ›å»ºçš„æ–‡ä»¶ç›®å½•ã€æ–­å¼€æ•°æ®åº“è¿æ¥å¥æŸ„ç­‰

```objective-c
- (void)testWriteMethodOfFileManager {
	[_sut createFile:filepath];
	[_sut write:filepath content:jsonString encoding:NSUTF8StringEncoding];
	NSString *fetchContent = [_sut readContents:filepath];
	XCTAssertTrue([fetchContent isEqualToString:jsonString], @"Oops, thers is something wrong with write:content:encoding: method of FileManager");
}

- (void)tearDown {
  [_sut deleteFile:filepath];
}
```

### 11.  å†™å•æµ‹çš„è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€æ¬¡ Code Review çš„è¿‡ç¨‹

çœ‹åˆ°æŸä¸ªæ–¹æ³•éš¾ä»¥ç¼–å†™å•æµ‹ã€æˆ–è€…ä¸å¥½æµ‹ï¼Œå½“æ¢³ç†æ¸…æ¥šåï¼Œå¯ä»¥å¯¹è¯¥æ®µé€»è¾‘ä»£ç è¿›è¡Œé‡æ„ã€‚



### 12. æŠŠå•æµ‹è§†ä¸ºâ€œä¸€ç­‰å…¬æ°‘â€

æµ‹è¯•ç”¨ä¾‹åº”è¯¥è¢«è§†ä¸ºâ€œä¸€ç­‰å…¬æ°‘â€ï¼ŒåŒæ ·éœ€è¦ Code Reviewï¼ŒåŒæ ·éœ€è¦é‡è§†è®¾è®¡å’Œè´¨é‡ï¼Œç¡®ä¿å•å…ƒæµ‹è¯•çš„æœ‰æ•ˆæ€§ã€‚

å•å…ƒæµ‹è¯•çš„ä»£ç è¯„å®¡çš„è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯å›¢é˜ŸåŒå­¦äº’ç›¸å­¦ä¹ å€Ÿé‰´çš„è¿‡ç¨‹ï¼Œæ²‰æ·€æœ€ä½³å®è·µçš„è¿‡ç¨‹ã€‚



### 13. ç»“åˆå¥½å®˜æ–¹å·¥å…·

ç»™å½“å‰å·¥ç¨‹æ‰“å¼€æµ‹è¯•è¦†ç›–ç‡å¼€å…³ã€‚è·¯å¾„ï¼šé¡¹ç›® icon ä¸‹çš„ Edit Scheme - å·¦ä¾§é€‰æ‹© Test ï¼Œå³ä¾§é€‰æ‹© Optionsï¼Œç„¶åé€‰æ‹© Code Coverageï¼Œå‹¾é€‰å³å¯

<img src="https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/Xcode-CoverageGather.png" style="zoom:40%">

å¯¹äºæ¯æ¬¡æµ‹è¯•åï¼Œå¯ä»¥åœ¨ Xcode å€’æ•°ç¬¬å››ä¸ªé€‰é¡¹å¯ä»¥çœ‹åˆ°æ€»çš„æµ‹è¯•ç”¨ä¾‹æ•°ï¼Œå¤±è´¥çš„ä¸ªæ•°ã€‚å¦‚æœè¦æ¸…æ¥šçš„çŸ¥é“å“ªäº› case å¤±è´¥ï¼Œåˆ™å¯ä»¥ç‚¹å‡»å³ä¸‹è§’ä¸­é—´çš„æŒ‰é’®ï¼Œå¯ä»¥ç­›é€‰å‡ºå¤±è´¥çš„ caseã€‚

<img src="https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/Xcode-UnitTestPanel.png" style="zoom:30%; align:left;">



### 14. setUp æ–¹æ³•ä¸­åšä¸€äº›è®¾ç½®çš„åˆå§‹åŒ–é…ç½®

æ¯”å¦‚éœ€è¦å¯¹ä¸€ä¸ªæ•°æ®åº“å·¥å…·ç±»è¿›è¡Œæµ‹è¯•ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ setUp æ–¹æ³•å†…ï¼Œè®¾ç½®æ•°æ®åº“è¿æ¥å¥æŸ„ã€è®¾ç½®æ‰“å¼€çš„æ•°æ®åº“åœ°å€ä¿¡æ¯ï¼Œç„¶åç»™å½“å‰æµ‹è¯•ç±»è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡

```
#import "DBHelper.h"

@interface DBHelpTest:XCTestCase {
		DBHelper *_sut;
}
@end

@implementation DBHelpTest 
- (void)setUp {
	 NSString *docsPath = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES)[0];
   NSString *dbPath = [docsPath stringByAppendingPathComponent:HCT_LOG_DATABASE_NAME];
	 _sut = [[DBHelper alloc] initWithDB:dbPath];
}

- (void)testCreateTable {
	[_sut createTable:tableName];
	NSString *tableNameGot = [_sut allTable].first;
	XCTAssert([tableNameGot isEqualToString:tableName], @"Oops, there is something wrong with createTable: method of DBHelper");
}

// ...
@end

```





## å››ã€ç½‘ç»œæµ‹è¯•

æˆ‘ä»¬åœ¨æµ‹è¯•æŸä¸ªæ–¹æ³•çš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°æ–¹æ³•å†…éƒ¨è°ƒç”¨äº†ç½‘ç»œé€šä¿¡èƒ½åŠ›ï¼Œç½‘ç»œè¯·æ±‚æˆåŠŸï¼Œå¯èƒ½åˆ·æ–° UI æˆ–è€…ç»™å‡ºä¸€äº›æˆåŠŸçš„æç¤ºï¼›ç½‘ç»œå¤±è´¥æˆ–è€…ç½‘ç»œä¸å¯ç”¨åˆ™ç»™å‡ºä¸€äº›å¤±è´¥çš„æç¤ºã€‚æ‰€ä»¥éœ€è¦å¯¹ç½‘ç»œé€šä¿¡å»çœ‹è¿›è¡Œæ¨¡æ‹Ÿã€‚

iOS ä¸­å¾ˆå¤šç½‘ç»œéƒ½æ˜¯åŸºäº NSURL ç³»ç»Ÿä¸‹çš„ç±»å®ç°çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ `NSURLProtocol` çš„èƒ½åŠ›æ¥ç›‘æ§ç½‘ç»œå¹¶ mock ç½‘ç»œæ•°æ®ã€‚å¦‚æœæ„Ÿå…´è¶£å¯ä»¥æŸ¥çœ‹[è¿™ç¯‡æ–‡ç« ](https://github.com/FantasticLBP/knowledge-kit/blob/master/Chapter1%20-%20iOS/1.74.md#äº”-app-ç½‘ç»œç›‘æ§)ã€‚

å¼€æºé¡¹ç›® [OHHTTPStubs](https://github.com/AliSoftware/OHHTTPStubs)  å°±æ˜¯ä¸€ä¸ªå¯¹ç½‘ç»œæ¨¡æ‹Ÿçš„åº“ã€‚å®ƒå¯ä»¥æ‹¦æˆª HTTP è¯·æ±‚ï¼Œè¿”å› json æ•°æ®ï¼Œå®šåˆ¶å„ç§å¤´ä¿¡æ¯ã€‚

> Stub your network requests easily! Test your apps with fake network data and custom response time, response code and headers!

å‡ ä¸ªä¸»è¦ç±»åŠå…¶åŠŸèƒ½ï¼š`HTTPStubsProtocol` æ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼›`HTTPStubs` å•ä¾‹ç®¡ç† `HTTPStubsDescriptor` å®ä¾‹å¯¹è±¡ï¼›`HTTPStubsResponse` ä¼ªé€  HTTP è¯·æ±‚ã€‚

`HTTPStubsProtocol` ç»§æ‰¿è‡ª `NSURLProtocol`ï¼Œå¯ä»¥åœ¨ HTTP è¯·æ±‚å‘é€ä¹‹å‰å¯¹ request è¿›è¡Œè¿‡æ»¤å¤„ç†

```objective-c
+ (BOOL)canInitWithRequest:(NSURLRequest *)request
{
   BOOL found = ([HTTPStubs.sharedInstance firstStubPassingTestForRequest:request] != nil);
   if (!found && HTTPStubs.sharedInstance.onStubMissingBlock) {
      HTTPStubs.sharedInstance.onStubMissingBlock(request);
   }
   return found;
}
```

`firstStubPassingTestForRequest` æ–¹æ³•å†…éƒ¨ä¼šåˆ¤æ–­è¯·æ±‚æ˜¯å¦éœ€è¦è¢«å½“å‰å¯¹è±¡å¤„ç†

ç´§æ¥ç€å¼€å§‹å‘é€ç½‘ç»œè¯·æ±‚ã€‚å®é™…ä¸Šåœ¨ `- (void)startLoading` æ–¹æ³•ä¸­å¯ä»¥ç”¨ä»»ä½•ç½‘ç»œèƒ½åŠ›å»å®Œæˆè¯·æ±‚ï¼Œæ¯”å¦‚ NSURLSessionã€NSURLConnectionã€AFNetworking æˆ–å…¶ä»–ç½‘ç»œæ¡†æ¶ã€‚OHHTTPStubs çš„åšæ³•æ˜¯è·å– requestã€client å¯¹è±¡ã€‚å¦‚æœ  HTTPStubs å•ä¾‹ä¸­åŒ…å« `onStubActivationBlock` å¯¹è±¡ï¼Œåˆ™æ‰§è¡Œè¯¥ blockï¼Œç„¶ååˆ©ç”¨ responseBlock å¯¹è±¡è¿”å›ä¸€ä¸ª HTTPStubsResponse å“åº”å¯¹è±¡ã€‚

OHHTTPStubs çš„å…·ä½“ API å¯ä»¥æŸ¥çœ‹[æ–‡æ¡£](https://github.com/AliSoftware/OHHTTPStubs/wiki/Usage-Examples)ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œåˆ©ç”¨ Kiwiã€OHHTTPStubs æµ‹è¯•ç¦»çº¿åŒ…åŠŸèƒ½ã€‚ä»£ç å¦‚ä¸‹

```objective-c
@interface HORouterManager (Unittest)

- (void)fetchOfflineInfoIfNeeded;

@end

SPEC_BEGIN(HORouterTests)

describe(@"routerTests", ^{
    context(@"criticalPath", ^{
        __block HORouterManager *routerManager = nil;
        beforeAll(^{
            routerManager = [[HORouterManager alloc] init];
        });
        it(@"getLocalPath", ^{
            __block NSString *pagePath = nil;
            dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(4 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
                pagePath = [routerManager filePathOfUrl:@"http://***/resource1"];
            });
            [[expectFutureValue(pagePath) shouldEventuallyBeforeTimingOutAfter(5)] beNonNil];

            __block NSString *rescPath = nil;
            dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(4 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
                rescPath = [routerManager filePathOfUrl:@"http://***/resource1"];
            });
            [[expectFutureValue(rescPath) shouldEventuallyBeforeTimingOutAfter(5)] beNonNil];
        });
        it(@"fetchOffline", ^{
            [HOOfflineManager sharedInstance].offlineInfoInterval = 0;
            [OHHTTPStubs stubRequestsPassingTest:^BOOL(NSURLRequest *request) {
                return [request.URL.absoluteString containsString:@"h5-offline-pkg"];
            } withStubResponse:^OHHTTPStubsResponse*(NSURLRequest *request) {
                NSMutableDictionary *dict = [NSMutableDictionary dictionary];
                dict[@"code"] = @(0);
                dict[@"data"] = @"f722fc3efce547897819e9449d2ac562cee9075adda79ed74829f9d948e2f6d542a92e969e39dfbbd70aa2a7240d6fa3e51156c067e8685402727b6c13328092ecc0cbc773d95f9e0603b551e9447211b0e3e72648603e3d18e529b128470fa86aeb45d16af967d1a21b3e04361cfc767b7811aec6f19c274d388ddae4c8c68e857c14122a44c92a455051ae001fa7f2b177704bdebf8a2e3277faf0053460e0ecf178549e034a086470fa3bf287abbdd0f79867741293860b8a29590d2c2bb72b749402fb53dfcac95a7744ad21fe7b9e188881d1c24047d58c9fa46b3ebf4bc42a1defc50748758b5624c6c439c182fe21d4190920197628210160cf279187444bd1cb8707362cc4c3ab7486051af088d7851846bea21b64d4a5c73bd69aafc4bb34eb0862d1525c4f9a62ce64308289e2ecbc19ea105aa2bf99af6dd5a3ff653bbe7893adbec37b44a088b0b74b80532c720c79b7bb59fda3daf85b34ef35";
                NSData *data = [NSJSONSerialization dataWithJSONObject:dict options:0 error:nil];
                return [OHHTTPStubsResponse responseWithData:data
                                                  statusCode:200
                                                     headers:@{@"Content-Type":@"application/json"}];
            }];
            [routerManager fetchOfflineInfoIfNeeded];
            [[HOOfflineInfo shouldEventually] receive:@selector(saveToLocal:)];
        });
    });
});

SPEC_END
```

ğŸ˜‚ æ’ä¸€å˜´ï¼Œæˆ‘è´´çš„ä»£ç å·²ç»å¥½å‡ æ¬¡å¯ä»¥çœ‹åˆ°ä¸åŒçš„æµ‹è¯•æ¡†æ¶ç»„åˆäº†ï¼Œæ‰€ä»¥ä¸æ˜¯è¯´é€‰äº†æ¡†æ¶ A å°±å®Œäº‹ï¼Œæ ¹æ®åœºæ™¯é€‰æ‹©æœ€ä¼˜è§£ã€‚

## äº”ã€UI æµ‹è¯•

ä¸Šé¢æ–‡ç« å¤§ç¯‡å¹…çš„è®²äº†å•å…ƒæµ‹è¯•ç›¸å…³çš„è¯é¢˜ï¼Œå•å…ƒæµ‹è¯•ååˆ†é€‚åˆä»£ç è´¨é‡ã€é€»è¾‘ã€ç½‘ç»œç­‰å†…å®¹çš„æµ‹è¯•ï¼Œä½†æ˜¯é’ˆå¯¹æœ€ç»ˆäº§ç‰© App æ¥è¯´å•å…ƒæµ‹è¯•å°±ä¸å¤ªé€‚åˆäº†ï¼Œå¦‚æœæµ‹è¯• UI ç•Œé¢çš„æ­£ç¡®æ€§ã€åŠŸèƒ½æ˜¯å¦æ­£ç¡®æ˜¾ç„¶å°±ä¸å¤ªé€‚åˆäº†ã€‚Apple åœ¨ Xcode 7 å¼€å§‹æ¨å‡ºçš„ `UI Testing`  å°±æ˜¯è‹¹æœè‡ªå·±çš„ UI æµ‹è¯•æ¡†æ¶ã€‚

å¾ˆå¤š UI è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶çš„åº•å±‚å®ç°éƒ½ä¾èµ–äº `Accessibility`ï¼Œä¹Ÿå°±æ˜¯ App å¯ç”¨æ€§ã€‚`UI Accessibility` æ˜¯ iOS 3.0 å¼•å…¥çš„ä¸€ä¸ªäººæ€§åŒ–åŠŸèƒ½ï¼Œå¸®åŠ©èº«ä½“ä¸ä¾¿çš„äººå£«æ–¹ä¾¿ä½¿ç”¨ Appã€‚

Accessibility é€šè¿‡å¯¹ UI å…ƒç´ è¿›è¡Œåˆ†ç±»å’Œæ ‡è®°ã€‚åˆ†ç±»æˆç±»ä¼¼æŒ‰é’®ã€æ–‡æœ¬æ¡†ã€æ–‡æœ¬ç­‰ç±»å‹ï¼Œä½¿ç”¨ identifier æ¥åŒºåˆ†ä¸åŒ UI å…ƒç´ ã€‚[æ— ç—•åŸ‹ç‚¹çš„è®¾è®¡ä¸å®ç°](https://github.com/FantasticLBP/knowledge-kit/blob/master/Chapter1%20-%20iOS/1.55.md)é‡Œé¢ä¹Ÿä½¿ç”¨ `accessibilityIdentifier` æ¥ç»‘å®šä¸šåŠ¡æ•°æ®ã€‚

1. ä½¿ç”¨ Xcode è‡ªå¸¦çš„ UIæµ‹è¯•åˆ™åœ¨åˆ›å»ºå·¥ç¨‹çš„æ—¶å€™éœ€è¦å‹¾é€‰ â€œInclude UI Testsâ€ã€‚
2. åƒå•å…ƒæµ‹è¯•æ„ä¹‰ï¼ŒUI æµ‹è¯•æ–¹æ³•å‘½åä»¥ test å¼€å¤´ã€‚å°†é¼ æ ‡å…‰æ ‡ç§»åˆ°æ–¹æ³•å†…ï¼Œç‚¹å‡» Xcode å·¦ä¸‹æ–¹çš„çº¢è‰²æŒ‰é’®ï¼Œå¼€å§‹å½•åˆ¶ UI è„šæœ¬ã€‚

![UI è„šæœ¬å½•åˆ¶](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-07-15-XcodeUITesting.png)

è§£é‡Šè¯´æ˜ï¼š

```objective-c
/*! Proxy for an application that may or may not be running. */
@interface XCUIApplication : XCUIElement
// ...
@end
```

- `XCUIApplication launch` æ¥å¯åŠ¨æµ‹è¯•ã€‚`XCUIApplication` æ˜¯ UIApplication åœ¨æµ‹è¯•è¿›ç¨‹ä¸­çš„ä»£ç†ï¼Œç”¨æ¥å’Œ App è¿›è¡Œä¸€äº›äº¤äº’ã€‚

- ä½¿ç”¨ `staticTexts`æ¥è·å–å½“å‰å±å¹•ä¸Šçš„é™æ€æ–‡æœ¬ï¼ˆUILabelï¼‰å…ƒç´ çš„ä»£ç†ã€‚ç­‰ä»·äº `[app descendantsMatchingType:XCUIElementTypeStaticText]`ã€‚XCUIElementTypeStaticText å‚æ•°æ˜¯æšä¸¾ç±»å‹ã€‚
  
  ```objective-c
  typedef NS_ENUM(NSUInteger, XCUIElementType) {
      XCUIElementTypeAny = 0,
      XCUIElementTypeOther = 1,
      XCUIElementTypeApplication = 2,
      XCUIElementTypeGroup = 3,
      XCUIElementTypeWindow = 4,
      XCUIElementTypeSheet = 5,
      XCUIElementTypeDrawer = 6,
      XCUIElementTypeAlert = 7,
      XCUIElementTypeDialog = 8,
      XCUIElementTypeButton = 9,
      XCUIElementTypeRadioButton = 10,
      XCUIElementTypeRadioGroup = 11,
      XCUIElementTypeCheckBox = 12,
      XCUIElementTypeDisclosureTriangle = 13,
      XCUIElementTypePopUpButton = 14,
      XCUIElementTypeComboBox = 15,
      XCUIElementTypeMenuButton = 16,
      XCUIElementTypeToolbarButton = 17,
      XCUIElementTypePopover = 18,
      XCUIElementTypeKeyboard = 19,
      XCUIElementTypeKey = 20,
      XCUIElementTypeNavigationBar = 21,
      XCUIElementTypeTabBar = 22,
      XCUIElementTypeTabGroup = 23,
      XCUIElementTypeToolbar = 24,
      XCUIElementTypeStatusBar = 25,
      XCUIElementTypeTable = 26,
      XCUIElementTypeTableRow = 27,
      XCUIElementTypeTableColumn = 28,
      XCUIElementTypeOutline = 29,
      XCUIElementTypeOutlineRow = 30,
      XCUIElementTypeBrowser = 31,
      XCUIElementTypeCollectionView = 32,
      XCUIElementTypeSlider = 33,
      XCUIElementTypePageIndicator = 34,
      XCUIElementTypeProgressIndicator = 35,
      XCUIElementTypeActivityIndicator = 36,
      XCUIElementTypeSegmentedControl = 37,
      XCUIElementTypePicker = 38,
      XCUIElementTypePickerWheel = 39,
      XCUIElementTypeSwitch = 40,
      XCUIElementTypeToggle = 41,
      XCUIElementTypeLink = 42,
      XCUIElementTypeImage = 43,
      XCUIElementTypeIcon = 44,
      XCUIElementTypeSearchField = 45,
      XCUIElementTypeScrollView = 46,
      XCUIElementTypeScrollBar = 47,
      XCUIElementTypeStaticText = 48,
      XCUIElementTypeTextField = 49,
      XCUIElementTypeSecureTextField = 50,
      XCUIElementTypeDatePicker = 51,
      XCUIElementTypeTextView = 52,
      XCUIElementTypeMenu = 53,
      XCUIElementTypeMenuItem = 54,
      XCUIElementTypeMenuBar = 55,
      XCUIElementTypeMenuBarItem = 56,
      XCUIElementTypeMap = 57,
      XCUIElementTypeWebView = 58,
      XCUIElementTypeIncrementArrow = 59,
      XCUIElementTypeDecrementArrow = 60,
      XCUIElementTypeTimeline = 61,
      XCUIElementTypeRatingIndicator = 62,
      XCUIElementTypeValueIndicator = 63,
      XCUIElementTypeSplitGroup = 64,
      XCUIElementTypeSplitter = 65,
      XCUIElementTypeRelevanceIndicator = 66,
      XCUIElementTypeColorWell = 67,
      XCUIElementTypeHelpTag = 68,
      XCUIElementTypeMatte = 69,
      XCUIElementTypeDockItem = 70,
      XCUIElementTypeRuler = 71,
      XCUIElementTypeRulerMarker = 72,
      XCUIElementTypeGrid = 73,
      XCUIElementTypeLevelIndicator = 74,
      XCUIElementTypeCell = 75,
      XCUIElementTypeLayoutArea = 76,
      XCUIElementTypeLayoutItem = 77,
      XCUIElementTypeHandle = 78,
      XCUIElementTypeStepper = 79,
      XCUIElementTypeTab = 80,
      XCUIElementTypeTouchBar = 81,
      XCUIElementTypeStatusItem = 82,
  };
  ```

- é€šè¿‡ `XCUIApplication` å®ä¾‹åŒ–å¯¹è±¡è°ƒç”¨ `descendantsMatchingType:` æ–¹æ³•å¾—åˆ°çš„æ˜¯ `XCUIElementQuery` ç±»å‹ã€‚æ¯”å¦‚ `@property (readonly, copy*) XCUIElementQuery *staticTexts;`
  
  ```objective-c
  /*! Returns a query for all descendants of the element matching the specified type. */
  - (XCUIElementQuery *)descendantsMatchingType:(XCUIElementType)type;
  ```

- `descendantsMatchingType` è¿”å›æ‰€æœ‰åä»£çš„ç±»å‹åŒ¹é…å¯¹è±¡ã€‚`childrenMatchingType` è¿”å›å½“å‰å±‚çº§å­å…ƒç´ çš„ç±»å‹åŒ¹é…å¯¹è±¡
  
  ```objective-c
  /*! Returns a query for direct children of the element matching the specified type. */
  - (XCUIElementQuery *)childrenMatchingType:(XCUIElementType)type;
  ```

- æ‹¿åˆ° `XCUIElementQuery` åä¸èƒ½ç›´æ¥æ‹¿åˆ° `XCUIElement`ã€‚å’Œ `XCUIApplication` ç±»ä¼¼ï¼Œ`XCUIElement` ä¸èƒ½ç›´æ¥è®¿é—® UI å…ƒç´ ï¼Œå®ƒæ˜¯ UI å…ƒç´ åœ¨æµ‹è¯•æ¡†æ¶ä¸­çš„ä»£ç†ã€‚å¯ä»¥é€šè¿‡ `Accessibility` ä¸­çš„ `frame`ã€`identifier` æ¥è·å–ã€‚

å¯¹æ¯”å¾ˆå¤šè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶éƒ½éœ€è¦æ‰¾å‡º UI å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å€ŸåŠ©äº `Accessibility` çš„ `identifier`ã€‚è¿™é‡Œçš„å”¯ä¸€æ ‡è¯†ç”Ÿæˆå¯¹æ¯”[ä¸º UIAutomation æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•æ ‡ç­¾çš„æ¢ç´¢](http://yulingtianxia.com/blog/2016/03/28/Add-UITest-Label-for-UIAutomation/)]

ç¬¬ä¸‰æ–¹ UI è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶æŒºå¤šçš„ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹å…¸å‹çš„ [appium](https://github.com/appium/appium)ã€[macaca](https://github.com/alibaba/macaca)ã€‚



## å…­ã€ç²¾å‡†æµ‹è¯•

ç²¾å‡†æµ‹è¯•æ˜¯æœ€è¿‘å¾ˆç«çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä½†æ˜¯ä¹Ÿä¸ç®—åœ¨æ¦‚å¿µé˜¶æ®µï¼Œå¾ˆå¤šå…¬å¸éƒ½è½åœ°å¹¶å®æ–½äº†ç²¾å‡†æµ‹è¯•ã€‚å•æµ‹æ˜¯å¼€å‘è€…ä¸ºäº†æ–¹æ³•çº§åˆ«å†™çš„æµ‹è¯•ç”¨ä¾‹ã€‚ç²¾å‡†æµ‹è¯•æ˜¯ä»£ç çº§åˆ«çš„æµ‹è¯•è¦†ç›–ã€‚

ä»·å€¼ï¼š

- ååŠ©ç ”å‘å°ä¼™ä¼´å‘ç°é—®é¢˜å’Œæ¼æµ‹ã€æ„ŸçŸ¥ QA åŒå­¦æµ‹è¯•èŒƒå›´
- æµ‹è¯•äººå‘˜æ„ŸçŸ¥ç ”å‘åŒå­¦ä»£ç è´¨é‡ï¼Œåå‘é©±åŠ¨ç ”å‘ä¾§è´¨é‡æŠŠæ§ï¼Œå¢åŠ è´¨é‡æŠŠæ§æŠ“æ‰‹
- åœ¨äº§å“äº¤ä»˜æµç¨‹ä¸­å¤šä¸ªç¯èŠ‚èµ‹èƒ½è´¨é‡

æ¯”å¦‚ç›®å‰éƒ½æ˜¯äº§å“è®¾è®¡å¸ˆå»è®¾è®¡æµ‹è¯•ç”¨ä¾‹ï¼Œé‚£ä¹ˆæµ‹è¯•ç”¨ä¾‹å…¨ä¸å…¨æ˜¯ä¸€å›äº‹ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä¸šåŠ¡è€å¸æœºå»å‚ä¸æµ‹è¯•ç”¨ä¾‹çš„è¯„å®¡ï¼Œå¹¶ç»™å‡ºä¸€äº›å»ºè®®å’Œæµ‹è¯• case çš„è¡¥å……ã€‚

å¦å¤–å‡è®¾æœ‰äº†næ¡æµ‹è¯•ç”¨ä¾‹ï¼Œé‚£è¿™ n æ¡æµ‹è¯•ç”¨ä¾‹ï¼Œèƒ½ä¸èƒ½è¦†ç›–å¼€å‘åŒå­¦å†™çš„æ¯ä¸€è¡Œä»£ç ï¼Ÿå¯èƒ½æœ‰äº›äººä¼šå¥½å¥‡å•æµ‹ä¸æ˜¯ä¿è¯äº†æ–¹æ³•è¢«è¦†ç›–äº†å—ï¼Ÿå•æµ‹ä¸»è¦é’ˆå¯¹é€»è¾‘æ–¹æ³•ï¼Œå¯æ˜¯ç”¨æˆ·ä½¿ç”¨çš„äº§å“æ˜¯ç»è¿‡é€»è¾‘è¿ç®—åï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†é€»è¾‘æ˜¯ UI å±‚çš„ï¼Œå¯èƒ½æ‹¿åˆ° Model ååœ¨ç•Œé¢å±•ç¤ºçš„åœ°æ–¹ï¼Œèµ°äº†å‡ ä¸ª UI æ–¹æ³•ï¼Œæ•°æ®å°±ä¸å¯¹äº†ï¼Œè¿™æ—¶å€™å¯èƒ½å°±æ˜¯çº¿ä¸Š bug äº§ç”Ÿçš„åŸå› ã€‚æ‰€ä»¥è¿™ä¸€ç¯èŠ‚ï¼Œç²¾å‡†æµ‹è¯•å¯ä»¥å»å‘ç°å¹¶è§£å†³ã€‚

ç²¾å‡†æµ‹è¯•æ˜¯æ‹¿å½“å‰å¼€å‘çš„ä»£ç å’Œä¸Šä¸€æ¬¡åŸºå‡†åˆ†æ”¯çš„ä»£ç è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­å˜åŠ¨äº†mè¡Œï¼Œå¦‚æœäº§å“è®¾è®¡å¸ˆæä¾›çš„æµ‹è¯•ç”¨ä¾‹åªè¦†ç›–äº†å…¶ä¸­çš„nè¡Œï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ m-n è¡Œå°±æ˜¯é£é™©ä»£ç ã€‚è¦å‚¬ä¿ƒè¡¥å……æµ‹è¯•ç”¨ä¾‹ï¼Œå°†è¿™å‰©ä¸‹çš„ m-n è¡Œä»£ç è¦†ç›–å®Œå…¨ï¼Œè¿™æ ·çš„ä»£ç æ‰æ˜¯ç¨³å®šçš„ã€å¯é çš„ã€‚

ä¸‹é¢æ˜¯ä¹‹å‰åœ¨æœ‰èµï¼Œå¼€å‘å®Œç²¾å‡†æµ‹è¯•ç³»ç»Ÿåï¼Œè½åœ°åˆ°ä¸€ä¸ªä¸šåŠ¡é¡¹ç›®ä¸­å–å¾—çš„ä»·å€¼ï¼Œå¸®åŠ©2ä½ QA å‘ç°æ¼æµ‹çš„ä»£ç ï¼Œå€’é€¼ QA å»è®¾è®¡æ›´å®Œå–„çš„æµ‹è¯• caseã€åˆ†æè¦†ç›–ç‡ä½æ˜¯å¼€å‘è€…çš„å…œåº•ä»£ç å¤ªå¤šè¿˜æ˜¯çœŸçš„æ¼æ‰äº†ä¸šåŠ¡ caseã€‚

<img src="https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/iOS_PreciousUnitTest1.png" style="zoom:20%;display:inline">                     <img src="https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/iOS_PreciousUnitTest2.png" style="zoom:20%;display:inline">

ç²¾å‡†æµ‹è¯•åŠ©åŠ›ä¸šåŠ¡ï¼Œè´¨é‡æ›´åŠ ç¨³å®šã€‚



## ä¸ƒã€ æµ‹è¯•ç»éªŒæ€»ç»“

TDD å†™å¥½æµ‹è¯•å†å†™ä¸šåŠ¡ä»£ç ï¼ŒBDD å…ˆå†™å®ç°ä»£ç ï¼Œå†å†™åŸºäºè¡Œä¸ºçš„æµ‹è¯•ä»£ç ã€‚å¦ä¸€ç§æ€è·¯æ˜¯æ²¡å¿…è¦é’ˆå¯¹æ¯ä¸ªç±»çš„ç§æœ‰æ–¹æ³•æˆ–è€…æ¯ä¸ªæ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼Œå› ä¸ºç­‰å…¨éƒ¨åŠŸèƒ½åšå®Œåé’ˆå¯¹æ¯ä¸ªç±»çš„æ¥å£æµ‹è¯•ï¼Œä¸€èˆ¬ä¼šè¦†ç›–æ®å¤§å¤šæ•°çš„æ–¹æ³•ã€‚ç­‰æµ‹è¯•å®Œçœ‹å¦‚æœæ–¹æ³•æœªè¢«è¦†ç›–ï¼Œåˆ™é’ˆå¯¹æ€§çš„è¡¥å…… `Unit Test`ã€‚

ç›®å‰ï¼ŒUI æµ‹è¯•ï¼ˆappiumï¼‰ è¿˜æ˜¯å»ºè®®åœ¨æ ¸å¿ƒé€»è¾‘ä¸”é•¿æ—¶é—´æ²¡æœ‰æ”¹åŠ¨çš„æƒ…å†µä¸‹å»åšï¼Œè¿™æ ·å­æ¯æ¬¡å‘ç‰ˆæœ¬çš„æ—¶å€™å¯ä»¥å½“ä½œæ ¸å¿ƒé€»è¾‘å›å½’äº†ï¼Œç›®å‰æ¥çœ‹ä»·å€¼æ˜¯æ–¹ä¾¿åç»­çš„è¿­ä»£å’Œç»´æŠ¤ä¸Šæœ‰ä¸€äº›ä¾¿åˆ©æ€§ã€‚å…¶ä»–çš„åŠŸèƒ½æ€§æµ‹è¯•è¿˜æ˜¯èµ° BDDã€‚

å¯¹äºç±»ã€å‡½æ•°ã€æ–¹æ³•çš„èµ° TDDï¼Œè€è€å®å®å†™ UTã€èµ° UT è¦†ç›–ç‡çš„æŠŠæ§ã€‚

UITesting è¿˜æ˜¯å»ºè®®åœ¨æ ¸å¿ƒé€»è¾‘ä¸”é•¿æ—¶é—´æ²¡æœ‰æ”¹åŠ¨çš„æƒ…å†µä¸‹å»åšï¼Œè¿™æ ·å­æ¯æ¬¡å‘ç‰ˆæœ¬çš„æ—¶å€™å¯ä»¥å½“ä½œæ ¸å¿ƒé€»è¾‘å›å½’ï¼Œç›®å‰æ¥çœ‹ä»·å€¼æ˜¯æ–¹ä¾¿åç»­çš„è¿­ä»£å’Œç»´æŠ¤ä¸Šæœ‰ä¸€äº›ä¾¿åˆ©æ€§ã€‚ä¾‹å¦‚ç”¨æˆ·ä¸­å¿ƒ SDK å‡çº§åï¼Œå½“æ—¶æœ‰äº†UITesingï¼ŒåŸºæœ¬ä¸Šå…å»äº†æµ‹è¯•äººå‘˜ä»‹å…¥ã€‚

å¦‚æœæ˜¯ä¸€äº›æ´»åŠ¨é¡µå’Œé€»è¾‘ç»å¸¸å˜åŠ¨çš„ï¼Œè€è€å®å®èµ°æµ‹è¯•é»‘ç›’...

æˆ‘è§‰å¾—å¤§å®¶ä¸€ç›´æœ‰ä¸ªè¯¯åŒºï¼Œå°±æ˜¯è§‰å¾—è½¯ä»¶æµ‹è¯•æ˜¯ä¸ºäº†è´¨é‡é¢å¤–åšçš„åŠŸï¼Œè¿™éƒ¨åˆ†åŠŸæ˜¯æœ‰ç”¨åŠŸè¿˜æ˜¯æ— ç”¨åŠŸæ˜¯ä¸ä¸€å®šçš„ã€‚å…¶å®ï¼Œæœ‰äº†æ­£ç¡®çš„å¼€å‘å§¿åŠ¿åï¼ˆé‚£ä»€ä¹ˆå«æ­£ç¡®çš„å¼€å‘å§¿åŠ¿ï¼Ÿè®¾è®¡ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™å°±åº”è¯¥æƒ³å¥½è¯¥æ–¹æ³•å¦‚ä½•æ›´æ–¹ä¾¿çš„è¢«æµ‹è¯•ï¼‰ï¼Œæœ€åå¯ä»¥å¯ä»¥å®ç°äº‹åŠåŠŸå€çš„æ•ˆæœï¼Œè‰¯å¥½çš„è´¨é‡éƒ½æ˜¯é™„é€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æµ‹è¯•å…ˆè¡Œæ˜¯è®©å¼€å‘æ›´å¿«æ›´å¥½çš„å±•å¼€ã€‚

![æµ‹è¯•å æ¯”](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/2020-07-14-TestingPercentage.png)

WWDC è¿™å¼ å›¾ä¹Ÿå¾ˆæ¸…æ¥šï¼ŒUI å…¶å®éœ€è¦çš„å æ¯”è¾ƒå°ï¼Œè¿˜æ˜¯è¦é å•æµ‹é©±åŠ¨ã€‚
