# Blockæ¢ç©¶


### 1ã€Blockä½œä¸ºå‡½æ•°å‚æ•°å¯ä»¥åº”ç”¨åˆ°å‡½æ•°å¼ç¼–ç¨‹
```
self.prepare.play(@"å¥³äºº");
- (ViewController *(^)(NSString *))play{
    NSLog(@"å³å°†åƒå–ç©ä¹");
    ViewController *(^block)(NSString *) = ^ViewController *(NSString *fun){
        NSLog(@"æ¥ä¸‹æ¥ç©%@ï¼Œå¥½ä¸å¥½ï¼Ÿ",fun);
        return self;
    };
    return block;
}

- (ViewController *)prepare{
    NSLog(@"æˆ‘ä»¬å…ˆå¥½å¥½ä¼‘æ¯ä¸€ä¸‹ã€‚ğŸ˜‚\n");
    return self;
}



```


###2ã€Blockä½œä¸ºå‡½æ•°çš„è¿”å›å€¼å¯ä»¥ä½œä¸ºé“¾å¼ç¼–ç¨‹


```
[self blockAsFunctionalProgramming];

- (void)blockAsFunctionalProgramming{
    [self reprepare:^{
        NSLog(@"æ¥ä¸‹æ¥ç©å¥³äººï¼Œå¥½ä¸å¥½ï¼ŸğŸ˜Š");
    }];
}

- (void)reprepare:(void(^)(void))replay{
    NSLog(@"æˆ‘ä»¬å…ˆå¥½å¥½ä¼‘æ¯ä¸€ä¸‹ã€‚ğŸ˜‚\n");
    replay();
}
@end
```

###3ã€Block è®¿é—®ã€ä¿®æ”¹å¤–éƒ¨å˜é‡

* æ‰“å¼€ Terminal.appï¼Œç¼–å†™ä¸€æ®µcä»£ç 

```
#include "stdio.h"

int main(){
    
    printf("Coming\n");
   __block  int a = 10;
    
    printf("å¼€å§‹->%p %d\n",&a,a);

    void(^block)(int a) =  ^void(int a){
        a += 10;
        printf("ä¸­é—´->%p %d\n",&a,a);
    };
    block(a);
    printf("ç»“æŸ->%p %d\n",&a,a);

    return 0;
}

```

* ä¹‹åç”¨ **gcc** ç¼–è¯‘ä¸€ä¸‹ã€‚åœ¨åŒå±‚ç›®å½•ä¸‹å¾—åˆ°ä¸€ä¸ª **a.out** çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

```
gcc index.c 

```

* ä¹‹åç”¨ **clang** ç¼–è¯‘æˆ C++ æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°ç³»ç»Ÿåº•å±‚æ˜¯å¦‚ä½•å¤„ç† block å¤–éƒ¨çš„å˜é‡ã€ä»¥åŠå¦‚ä½•åœ¨ block é‡Œé¢å¤„ç†å˜é‡çš„ã€‚

```
clang -rewrite-objc index.c 
```
![clangç»“æœ](https://raw.githubusercontent.com/FantasticLBP/knowledge-kit/master/assets/WX20180516-235614@2x.png)


###4ã€Block ç»å¸¸é€ æˆå¾ªç¯å¼•ç”¨
* å¦‚æœ block ä½œä¸ºå‡½æ•°å‚æ•°çš„è¯ï¼Œä¸”è¿™ä¸ªå‡½æ•°æ˜¯åœ¨å¯¹è±¡çš„å±‚çº§ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šé€ æˆå¾ªç¯åº”ç”¨ã€‚ self -> func -> block -> self.
æ­¤æ—¶éœ€è¦åœ¨ block é‡Œé¢è®¿é—® self çš„æ—¶å€™å°† self ä¿®é¥°ä¸º __weak